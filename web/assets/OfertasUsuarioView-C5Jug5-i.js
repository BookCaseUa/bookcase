import{_ as oe,B as ie,u as se,r,l as ne,m as v,z as re,a0 as ue,p as de,j as l,e as n,o as ce,d as t,i as u,t as d,a1 as T,a as P,a2 as me}from"./index-B0bI5t4i.js";const fe={__name:"OfertasUsuarioView",setup(ve){const O=ie(),E=se(),g=r([]),{t:i}=ne(),b=r(0),m=r("reciente"),f=r("reciente"),w=r(""),C=r(""),V=r(""),k=r(""),I=r(null),_=r(!1),D=v(()=>[{title:i("misOfertas.todas"),value:""},{title:i("misOfertas.nuevo"),value:"NEW"},{title:i("misOfertas.seminuevo"),value:"LIKE NEW"},{title:i("misOfertas.bueno"),value:"GOOD"},{title:i("misOfertas.aceptable"),value:"ACCEPTABLE"},{title:i("misOfertas.malo"),value:"BAD"}]),A=v(()=>[{title:i("misOfertas.todos"),value:""},{title:"ES",value:"ES"},{title:"EN",value:"EN"},{title:"FR",value:"FR"},{title:"DE",value:"DE"},{title:"IT",value:"IT"}]),B=v(()=>[{title:i("misOfertas.masReciente"),value:"reciente"},{title:i("misOfertas.precioAsc"),value:"precio-asc"},{title:i("misOfertas.precioDesc"),value:"precio-desc"},{title:i("misOfertas.titulo")+" (A-Z)",value:"titulo-az"},{title:i("misOfertas.titulo")+" (Z-A)",value:"titulo-za"}]),q=v(()=>[{title:i("misOfertas.titulo"),value:"edition_book_name",align:"center"},{title:i("misOfertas.precio"),value:"price",align:"center"},{title:i("misOfertas.condicion"),value:"condition",align:"center"},{title:i("misOfertas.idioma"),value:"language",align:"center"},{title:i("misOfertas.fecha"),value:"fecha",align:"center"},{title:i("misOfertas.comentario"),value:"comment",align:"center"},{title:i("misOfertas.acciones"),value:"acciones",align:"center",sortable:!1}]),R=v(()=>[{title:i("misOfertas.titulo"),value:"edition_book_name",align:"center"},{title:i("misOfertas.precio"),value:"price",align:"center"},{title:i("misOfertas.condicion"),value:"condition",align:"center"},{title:i("misOfertas.estado"),value:"status",align:"center"},{title:i("misOfertas.idioma"),value:"language",align:"center"},{title:i("misOfertas.fecha"),value:"fecha",align:"center"},{title:i("misOfertas.comentario"),value:"comment",align:"center"}]);let L=r(null);const S=r(""),y=r(""),W=({texto:a})=>{S.value=a},Z=({texto:a})=>{y.value=a};re(async()=>{const a=E.id,e=async()=>{await O.fetchOffers();const o=await O.getOffersForUserFiltered(a);o.result==="SUCCESS"&&(g.value=o.data)};e(),L=setInterval(e,6e5)}),ue(()=>{clearInterval(L)});const G=v(()=>{let a=g.value.filter(e=>e.data.status==="ACTIVE");if(w.value&&(a=a.filter(e=>e.data.condition===w.value)),a=a.map(e=>({id:e.id,edition_book_name:e.data.edition_book_name,price:e.data.price,condition:i(`misOfertas.condiciones.${e.data.condition}`),language:e.data.language,fecha:j(e.data.publication_date),comment:e.data.comment})),V.value&&(a=a.filter(e=>e.language===V.value)),S.value.trim()){const e=S.value.toLowerCase();a=a.filter(o=>o.edition_book_name.toLowerCase().includes(e)||o.comment.toLowerCase().includes(e))}return m.value==="precio-asc"?a.sort((e,o)=>e.price-o.price):m.value==="precio-desc"?a.sort((e,o)=>o.price-e.price):m.value==="titulo-az"?a.sort((e,o)=>e.edition_book_name.localeCompare(o.edition_book_name)):m.value==="titulo-za"?a.sort((e,o)=>o.edition_book_name.localeCompare(e.edition_book_name)):m.value==="reciente"&&a.sort((e,o)=>new Date(o.fecha)-new Date(e.fecha)),a}),K=a=>{me.push(`/editar-oferta/${a.id}`)},M=a=>{I.value=a,_.value=!0},h=async()=>{await O.deleteOffer(I.value.id);const a=E.id,e=await O.getOffersForUserFiltered(a);e.result==="SUCCESS"&&(g.value=e.data),_.value=!1},H=v(()=>{let a=g.value.filter(e=>e.data.status==="SOLD"||e.data.status==="IN CART");if(C.value&&(a=a.filter(e=>e.data.condition===C.value)),a=a.map(e=>({id:e.id,edition_book_name:e.data.edition_book_name,price:e.data.price,condition:i(`misOfertas.condiciones.${e.data.condition}`),status:i(`misOfertas.estados.${e.data.status}`),language:e.data.language,fecha:j(e.data.publication_date),comment:e.data.comment})),k.value&&(a=a.filter(e=>e.language===k.value)),y.value.trim()){const e=y.value.toLowerCase();a=a.filter(o=>o.edition_book_name.toLowerCase().includes(e)||o.comment.toLowerCase().includes(e))}return f.value==="precio-asc"?a.sort((e,o)=>e.price-o.price):f.value==="precio-desc"?a.sort((e,o)=>o.price-e.price):f.value==="titulo-az"?a.sort((e,o)=>e.edition_book_name.localeCompare(o.edition_book_name)):f.value==="titulo-za"?a.sort((e,o)=>o.edition_book_name.localeCompare(e.edition_book_name)):f.value==="reciente"&&a.sort((e,o)=>new Date(o.fecha)-new Date(e.fecha)),a}),j=a=>{try{return new Date(a.seconds*1e3).toLocaleDateString()}catch{return""}};return(a,e)=>{const o=n("v-tab"),J=n("v-tabs"),c=n("v-col"),U=n("v-btn"),$=n("v-row"),p=n("v-select"),z=n("v-icon"),F=n("v-data-table"),N=n("v-window-item"),Q=n("v-window"),X=n("v-card-title"),Y=n("v-card-text"),x=n("v-card-actions"),ee=n("v-card"),ae=n("v-dialog"),te=n("v-container");return ce(),de(te,{class:"contenedor-ofertas"},{default:l(()=>[t(J,{modelValue:b.value,"onUpdate:modelValue":e[0]||(e[0]=s=>b.value=s),"background-color":"primary",dark:""},{default:l(()=>[t(o,null,{default:l(()=>[u(d(a.$t("misOfertas.pesta単aActivas")),1)]),_:1}),t(o,null,{default:l(()=>[u(d(a.$t("misOfertas.pesta単aInactivas")),1)]),_:1})]),_:1},8,["modelValue"]),t(Q,{modelValue:b.value,"onUpdate:modelValue":e[8]||(e[8]=s=>b.value=s)},{default:l(()=>[t(N,{value:0},{default:l(()=>[t($,{class:"align-center my-4",justify:"space-between"},{default:l(()=>[t(c,{cols:"12",md:"3"},{default:l(()=>[t(T,{mostrarSelector:!1,placeholder:a.$t("home.buscarPorTituloComentario"),onBuscar:W},null,8,["placeholder"])]),_:1}),t(c,{cols:"12",md:"3",class:"d-flex justify-end align-end"},{default:l(()=>[t(U,{class:"boton-link-oferta",variant:"text","prepend-icon":"mdi-plus",onClick:e[1]||(e[1]=s=>a.$router.push("/addOffer"))},{default:l(()=>[u(d(a.$t("misOfertas.a単adirOferta")),1)]),_:1})]),_:1})]),_:1}),t($,{class:"align-center my-4",justify:"space-between"},{default:l(()=>[t(c,{cols:"12",md:"3"},{default:l(()=>[t(p,{modelValue:m.value,"onUpdate:modelValue":e[2]||(e[2]=s=>m.value=s),items:B.value,label:a.$t("misOfertas.ordenarPor"),outlined:"",dense:""},null,8,["modelValue","items","label"])]),_:1}),t(c,{cols:"12",md:"3"},{default:l(()=>[t(p,{modelValue:w.value,"onUpdate:modelValue":e[3]||(e[3]=s=>w.value=s),items:D.value,label:a.$t("misOfertas.filtrarCondicion"),outlined:"",dense:""},null,8,["modelValue","items","label"])]),_:1}),t(c,{cols:"12",md:"3"},{default:l(()=>[t(p,{modelValue:V.value,"onUpdate:modelValue":e[4]||(e[4]=s=>V.value=s),items:A.value,label:a.$t("misOfertas.filtrarIdioma"),outlined:"",dense:""},null,8,["modelValue","items","label"])]),_:1})]),_:1}),t(F,{class:"solo-encabezado",headers:q.value,items:G.value,"items-per-page":7},{"item.acciones":l(({item:s})=>[t(z,{class:"icono-accion",onClick:le=>K(s)},{default:l(()=>e[11]||(e[11]=[u("mdi-pencil")])),_:2},1032,["onClick"]),t(z,{class:"icono-accion-eliminar",onClick:le=>M(s)},{default:l(()=>e[12]||(e[12]=[u("mdi-delete")])),_:2},1032,["onClick"])]),"no-data":l(()=>[u(d(a.$t("misOfertas.sinOfertasActivas")),1)]),_:1},8,["headers","items"])]),_:1}),t(N,{value:1},{default:l(()=>[t($,{class:"align-center my-4",justify:"space-between"},{default:l(()=>[t(c,{cols:"12",md:"3"},{default:l(()=>[t(T,{mostrarSelector:!1,placeholder:a.$t("home.buscarPorTituloComentario"),onBuscar:Z},null,8,["placeholder"])]),_:1})]),_:1}),t($,{class:"align-center my-4",justify:"space-between"},{default:l(()=>[t(c,{cols:"12",md:"3"},{default:l(()=>[t(p,{modelValue:f.value,"onUpdate:modelValue":e[5]||(e[5]=s=>f.value=s),items:B.value,label:a.$t("misOfertas.ordenarPor"),outlined:"",dense:""},null,8,["modelValue","items","label"])]),_:1}),t(c,{cols:"12",md:"3"},{default:l(()=>[t(p,{modelValue:C.value,"onUpdate:modelValue":e[6]||(e[6]=s=>C.value=s),items:D.value,label:a.$t("misOfertas.filtrarCondicion"),outlined:"",dense:""},null,8,["modelValue","items","label"])]),_:1}),t(c,{cols:"12",md:"3"},{default:l(()=>[t(p,{modelValue:k.value,"onUpdate:modelValue":e[7]||(e[7]=s=>k.value=s),items:A.value,label:a.$t("misOfertas.filtrarIdioma"),outlined:"",dense:""},null,8,["modelValue","items","label"])]),_:1})]),_:1}),t(F,{class:"solo-encabezado",headers:R.value,items:H.value,"items-per-page":7},{"no-data":l(()=>[u(d(a.$t("misOfertas.sinOfertasInactivas")),1)]),_:1},8,["headers","items"])]),_:1})]),_:1},8,["modelValue"]),t(ae,{modelValue:_.value,"onUpdate:modelValue":e[10]||(e[10]=s=>_.value=s),width:"450",persistent:""},{default:l(()=>[t(ee,{class:"dialogo-eliminar"},{default:l(()=>[t(X,{class:"titulo-dialogo text-wrap text-center"},{default:l(()=>{var s;return[u(" 多 "+d(a.$t("misOfertas.eliminarOferta"))+' "',1),P("strong",null,d((s=I.value)==null?void 0:s.edition_book_name),1),e[13]||(e[13]=u('"? '))]}),_:1}),t(Y,{class:"texto-dialogo text-center"},{default:l(()=>[u(d(a.$t("misOfertas.textoDialogo1"))+" ",1),P("strong",null,d(a.$t("misOfertas.textoDialogo2")),1),e[14]||(e[14]=u(". "))]),_:1}),t(x,{class:"justify-center"},{default:l(()=>[t(U,{color:"grey",variant:"text",onClick:e[9]||(e[9]=s=>_.value=!1)},{default:l(()=>[u(d(a.$t("misOfertas.cancelar")),1)]),_:1}),t(U,{color:"red-darken-1",variant:"flat",onClick:h},{default:l(()=>[u(d(a.$t("misOfertas.eliminar")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}}},_e=oe(fe,[["__scopeId","data-v-02dd6521"]]);export{_e as default};
