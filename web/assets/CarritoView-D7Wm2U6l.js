import{_ as W,q as X,u as Y,B as x,C as ee,l as ae,r as _,z as oe,c as f,d as s,a as l,p as I,j as d,e as p,t as r,F as D,x as le,b as C,n as y,D as re,i as n,o as v}from"./index-B0bI5t4i.js";const ie={key:0,class:"checkout-container"},te={class:"carrito-resumen"},se={class:"checkout-volver"},ne={class:"titulo-resumen"},ue={key:1},de={style:{position:"relative"}},ce=["src"],ve={class:"carrito-info"},me={class:"vendedor"},pe={class:"checkout-box"},fe={class:"steps-header"},ge={key:0,class:"step-section"},be={class:"form-row"},_e={class:"form-row"},$e={class:"form-row"},Ce={class:"btn-continuar"},Ve={key:1,class:"step-section"},ke={class:"cards-envio"},Ee={key:0,class:"form-direccion"},ye={class:"form-row2"},he={class:"form-row2"},we={class:"btns"},Se={key:2,class:"step-section"},Pe={class:"resumen-final"},Ue={key:1,class:"mensaje-pago"},ze={key:2,class:"btns-final"},Ie={key:1,class:"carrito-vacio-container"},Be={class:"carrito-vacio"},je={class:"checkout-volver"},De={__name:"CarritoView",setup(Le){const B=X(),h=Y(),L=x(),w=ee(),{t:G}=ae(),V=_([]),S=_(!1),j=_(!0),k=_(""),g=_(1),a=_({nombre:"",apellidos:"",email:"",repetirEmail:"",telefono:"",direccion:"",cp:"",ciudad:"",provincia:"",metodoEnvio:""}),t=_({nombre:!1,apellidos:!1,email:"",repetirEmail:"",telefono:"",direccion:!1,cp:!1,ciudad:!1,provincia:!1}),N=["Álava","Albacete","Alicante","Almería","Asturias","Ávila","Badajoz","Barcelona","Burgos","Cáceres","Cádiz","Cantabria","Castellón","Ciudad Real","Córdoba","Cuenca","Gerona","Granada","Guadalajara","Guipúzcoa","Huelva","Huesca","Islas Baleares","Jaén","La Coruña","La Rioja","Las Palmas","León","Lérida","Lugo","Madrid","Málaga","Murcia","Navarra","Orense","Palencia","Pontevedra","Salamanca","Santa Cruz de Tenerife","Segovia","Sevilla","Soria","Tarragona","Teruel","Toledo","Valencia","Valladolid","Vizcaya","Zamora","Zaragoza"],u=_({email:!1,repetirEmail:!1,telefono:!1});oe(async()=>{const e=await w.getCartItems();await B.fetchEditions();const o=await Promise.all(e.map(async m=>{var P;const{id:U,data:$}=m,c=await h.fetchUserById($.seller_id),b=B.editions.find(z=>z.id===$.edition_id);return{id:U,edition_book_name:$.edition_book_name,condition:$.condition,language:$.language,price:$.price,seller_name:((P=c==null?void 0:c.data)==null?void 0:P.nickname)||"Usuario",image:(b==null?void 0:b.data.image)||"",edition:b==null?void 0:b.data.edition}}));V.value=o,j.value=!1});const E=_(!1),T=async()=>{E.value=!1,await A()};async function A(){for(const e of V.value){const o=e.id;try{await w.removeFromCart(o)}catch(m){console.error(" Error al quitar oferta del carrito:",o,m)}}w.cart=[],localStorage.setItem("cart",JSON.stringify({cart:[]})),V.value=[],await L.fetchOffers()}function M(){u.value.email=!0,u.value.repetirEmail=!0,u.value.telefono=!0;let e=!0;t.value.nombre=!a.value.nombre,t.value.apellidos=!a.value.apellidos,t.value.email="",t.value.repetirEmail="",t.value.telefono="";const o=/^[^\s@]+@[^\s@]+\.[^\s@]+$/;(!a.value.email||!o.test(a.value.email))&&(t.value.email="Introduce un email válido",e=!1),a.value.repetirEmail!==a.value.email&&(t.value.repetirEmail="Los correos no coinciden",e=!1),/^\d{9}$/.test(a.value.telefono)||(t.value.telefono="Introduce un teléfono válido",e=!1),(!a.value.nombre||!a.value.apellidos)&&(e=!1),e&&g.value++}u.value.provincia=!1,u.value.cp=!1;function O(){let e=!0;t.value.direccion=!a.value.direccion,t.value.cp=!a.value.cp,t.value.ciudad=!a.value.ciudad,t.value.provincia=!a.value.provincia,u.value.cp=!0,u.value.provincia=!0,t.value.cp="",(!a.value.metodoEnvio||t.value.direccion||t.value.cp||t.value.ciudad||t.value.provincia)&&(e=!1),/^\d{5}$/.test(a.value.cp)||(t.value.cp="Introduce un código postal válido",e=!1),e&&g.value++}async function R(){S.value=!0,k.value="Estamos procesando su operación...",await new Promise(o=>setTimeout(o,1e3)),h.telefono=a.value.telefono,h.direccion={direccion:a.value.direccion,cp:a.value.cp,ciudad:a.value.ciudad,provincia:a.value.provincia},await h.editUserInDatabase();const e=await w.buyCart();S.value=!1,e.result==="SUCCESS"?(k.value="Gracias por comprar con nosotros. Pago exitoso",V.value=[]):k.value="Hubo un error al procesar el pago: "+e.message}return(e,o)=>{const m=p("v-btn"),U=p("v-progress-circular"),$=p("v-chip"),c=p("v-text-field"),b=p("v-icon"),P=p("v-combobox"),z=p("v-progress-linear"),F=p("v-card-title"),H=p("v-card-text"),q=p("v-spacer"),J=p("v-card-actions"),Z=p("v-card"),K=p("v-dialog");return v(),f(D,null,[V.value.length>0?(v(),f("div",ie,[l("div",te,[l("div",se,[s(m,{class:"boton-inicio-rojo",color:"red",variant:"text",onClick:o[0]||(o[0]=i=>E.value=!0)},{default:d(()=>[n(r(e.$t("carrito.vaciarCarrito")),1)]),_:1})]),l("h2",ne,r(e.$t("carrito.resumen")),1),j.value?(v(),I(U,{key:0,indeterminate:"",color:"primary",class:"mb-4"})):(v(),f("div",ue,[(v(!0),f(D,null,le(V.value,(i,Q)=>(v(),f("div",{key:Q,class:"item-carrito"},[l("div",de,[l("img",{class:"carrito-imagen",src:i.image},null,8,ce),i.edition?(v(),I($,{key:0,class:"edition-number"},{default:d(()=>[n(r(i.edition)+"ª ed ",1)]),_:2},1024)):C("",!0)]),l("div",ve,[l("p",null,[l("strong",null,r(i.edition_book_name),1)]),l("p",null,r(e.$t(`carrito.${i.condition}`))+" · "+r(i.language)+" · "+r(i.price)+" € ",1),l("p",me,r(e.$t("carrito.vendedor"))+": "+r(i.seller_name),1)]),o[17]||(o[17]=l("hr",null,null,-1))]))),128))]))]),l("div",pe,[l("div",fe,[l("span",{class:y({active:g.value===1})},"1 "+r(e.$t("carrito.datosPersonales")),3),l("span",{class:y({active:g.value===2})},"2 "+r(e.$t("carrito.envio")),3),l("span",{class:y({active:g.value===3})},"3 "+r(e.$t("carrito.pago")),3)]),g.value===1?(v(),f("div",ge,[l("h2",null,r(e.$t("carrito.datosCliente")),1),l("p",null,r(e.$t("carrito.introduceDatos")),1),l("div",be,[s(c,{modelValue:a.value.nombre,"onUpdate:modelValue":o[1]||(o[1]=i=>a.value.nombre=i),label:e.$t("carrito.nombre"),variant:"solo",class:"input rounded",error:t.value.nombre,"error-messages":t.value.nombre?"Campo obligatorio":""},null,8,["modelValue","label","error","error-messages"]),s(c,{modelValue:a.value.apellidos,"onUpdate:modelValue":o[2]||(o[2]=i=>a.value.apellidos=i),label:e.$t("carrito.apellidos"),variant:"solo",class:"input rounded",error:t.value.apellidos,"error-messages":t.value.apellidos?"Campo obligatorio":""},null,8,["modelValue","label","error","error-messages"])]),l("div",_e,[s(c,{modelValue:a.value.email,"onUpdate:modelValue":o[3]||(o[3]=i=>a.value.email=i),label:e.$t("carrito.email"),variant:"solo",class:"input rounded",error:u.value.email&&!!t.value.email,"error-messages":u.value.email?t.value.email:""},null,8,["modelValue","label","error","error-messages"]),s(c,{modelValue:a.value.repetirEmail,"onUpdate:modelValue":o[4]||(o[4]=i=>a.value.repetirEmail=i),label:e.$t("carrito.repetirEmail"),variant:"solo",class:"input rounded",error:u.value.repetirEmail&&!!t.value.repetirEmail,"error-messages":u.value.repetirEmail?t.value.repetirEmail:""},null,8,["modelValue","label","error","error-messages"])]),l("div",$e,[s(c,{label:e.$t("carrito.prefijo"),variant:"solo",class:"input short rounded",value:"+34",readonly:""},null,8,["label"]),s(c,{modelValue:a.value.telefono,"onUpdate:modelValue":o[5]||(o[5]=i=>a.value.telefono=i),label:e.$t("carrito.telefono"),variant:"solo",class:"input rounded",error:u.value.telefono&&!!t.value.telefono,"error-messages":u.value.telefono?t.value.telefono:""},null,8,["modelValue","label","error","error-messages"])]),l("div",Ce,[s(m,{variant:"text",onClick:M},{default:d(()=>[n(r(e.$t("carrito.continuar")),1)]),_:1})])])):C("",!0),g.value===2?(v(),f("div",Ve,[l("h2",null,r(e.$t("carrito.dondeRecibir")),1),l("div",ke,[l("div",{class:y(["envio-card",{selected:a.value.metodoEnvio==="domicilio"}]),onClick:o[6]||(o[6]=i=>a.value.metodoEnvio="domicilio")},[s(b,{size:"36",class:"thin-icon"},{default:d(()=>o[18]||(o[18]=[n("mdi-home-outline")])),_:1}),l("h3",null,r(e.$t("carrito.envioDomicilio")),1),l("p",null,r(e.$t("carrito.entregaDireccion")),1)],2),l("div",{class:y(["envio-card",{selected:a.value.metodoEnvio==="punto"}]),onClick:o[7]||(o[7]=i=>a.value.metodoEnvio="punto")},[s(b,{size:"36",class:"thin-icon"},{default:d(()=>o[19]||(o[19]=[n("mdi-map-marker-outline")])),_:1}),l("h3",null,r(e.$t("carrito.puntoRecogida")),1),l("p",null,r(e.$t("carrito.recogerPedido")),1)],2)]),a.value.metodoEnvio?(v(),f("div",Ee,[l("h2",null,r(e.$t("carrito.datosEnvio")),1),l("div",ye,[s(c,{label:e.$t("carrito.direccion"),modelValue:a.value.direccion,"onUpdate:modelValue":o[8]||(o[8]=i=>a.value.direccion=i),class:"rounded flex-grow",variant:"solo"},null,8,["label","modelValue"]),s(c,{label:e.$t("carrito.masInfo"),class:"rounded flex-grow",variant:"solo"},null,8,["label"])]),l("div",he,[s(c,{modelValue:a.value.cp,"onUpdate:modelValue":o[9]||(o[9]=i=>a.value.cp=i),label:e.$t("carrito.codigoPostal"),class:"rounded short",variant:"solo",error:u.value.cp&&!!t.value.cp,"error-messages":u.value.cp?t.value.cp:""},null,8,["modelValue","label","error","error-messages"]),s(c,{label:e.$t("carrito.ciudad"),modelValue:a.value.ciudad,"onUpdate:modelValue":o[10]||(o[10]=i=>a.value.ciudad=i),variant:"solo",class:"rounded"},null,8,["label","modelValue"]),s(P,{modelValue:a.value.provincia,"onUpdate:modelValue":o[11]||(o[11]=i=>a.value.provincia=i),items:N,label:e.$t("carrito.provincia"),variant:"solo",class:"rounded",error:u.value.provincia&&!a.value.provincia,"error-messages":u.value.provincia&&!a.value.provincia?re(G)("carrito.campoObligatorio"):""},null,8,["modelValue","label","error","error-messages"]),s(c,{label:e.$t("carrito.pais"),value:"España",readonly:"",class:"rounded shorter",variant:"solo"},null,8,["label"])])])):C("",!0),l("div",we,[s(m,{variant:"text",onClick:o[12]||(o[12]=i=>g.value--)},{default:d(()=>[n(r(e.$t("carrito.volver")),1)]),_:1}),s(m,{variant:"text",onClick:O},{default:d(()=>[n(r(e.$t("carrito.continuar")),1)]),_:1})])])):C("",!0),g.value===3?(v(),f("div",Se,[S.value?(v(),I(z,{key:0,indeterminate:"",color:"primary",class:"mb-4"})):C("",!0),l("h2",null,r(e.$t("carrito.finalizarCompra")),1),l("p",null,r(e.$t("carrito.revisaDatos")),1),l("div",Pe,[l("p",null,[l("strong",null,r(e.$t("carrito.nombre"))+":",1),n(" "+r(a.value.nombre)+" "+r(a.value.apellidos),1)]),l("p",null,[l("strong",null,r(e.$t("carrito.email"))+":",1),n(" "+r(a.value.email),1)]),l("p",null,[l("strong",null,r(e.$t("carrito.telefono"))+":",1),n(" "+r(a.value.telefono),1)]),l("p",null,[l("strong",null,r(e.$t("carrito.direccion"))+":",1),n(" "+r(a.value.direccion)+r(a.value.infoExtra?", "+a.value.infoExtra:"")+", "+r(a.value.cp)+" - "+r(a.value.ciudad)+" ("+r(a.value.provincia)+") ",1)])]),k.value?(v(),f("div",Ue,r(k.value),1)):C("",!0),!S.value&&k.value!=="Gracias por comprar con nosotros. Pago exitoso"?(v(),f("div",ze,[s(m,{variant:"text",onClick:o[13]||(o[13]=i=>g.value--)},{default:d(()=>[n(r(e.$t("carrito.atras")),1)]),_:1}),s(m,{variant:"text",onClick:R},{default:d(()=>[n(r(e.$t("carrito.realizarPago")),1)]),_:1})])):C("",!0)])):C("",!0)])])):(v(),f("div",Ie,[l("div",null,[l("p",Be,[l("strong",null,r(e.$t("carrito.vacio")),1)]),l("div",je,[s(m,{class:"boton-inicio-azul",variant:"text",onClick:o[14]||(o[14]=i=>e.$router.push("/"))},{default:d(()=>[n(r(e.$t("carrito.irAComprar")),1)]),_:1})])])])),s(K,{modelValue:E.value,"onUpdate:modelValue":o[16]||(o[16]=i=>E.value=i),width:"500"},{default:d(()=>[s(Z,null,{default:d(()=>[s(F,{class:"headline"},{default:d(()=>[n(r(e.$t("carrito.vaciar")),1)]),_:1}),s(H,null,{default:d(()=>[n(r(e.$t("carrito.vaciarSeguro")),1)]),_:1}),s(J,{class:"botones-modal"},{default:d(()=>[s(m,{variant:"text",onClick:o[15]||(o[15]=i=>E.value=!1)},{default:d(()=>[n(r(e.$t("carrito.cancelar")),1)]),_:1}),s(q),s(m,{variant:"text",class:"boton-vaciar-modal",onClick:T},{default:d(()=>[n(r(e.$t("carrito.vaciar")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])],64)}}},Ne=W(De,[["__scopeId","data-v-43e362c8"]]);export{Ne as default};
