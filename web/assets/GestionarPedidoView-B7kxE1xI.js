import{_ as D,c as p,a as o,t as a,d as O,j as B,e as V,b as x,F as I,x as T,Y as q,B as G,q as L,u as R,r as U,z as j,E as F,h as M,o as m,i as z}from"./index-B0bI5t4i.js";const H={name:"GestionarPedido",setup(){const v=F(),s=q(),b=G(),e=L(),g=R(),f=M(),c=U({orderNumber:"",buyerName:"",shippingAddress:"",comment:"",status:"",totalPrice:0,shippingCost:0,books:[],buyerId:""});return j(async()=>{const l=v.params.id,n=await s.getOrder(l);if((n==null?void 0:n.result)==="SUCCESS"){n.data.buyer_id!==g.id&&f.push("/");const t=n.data,u=[];for(const d of t.offer_ids){const i=await b.getOffer(d);(i==null?void 0:i.result)==="SUCCESS"?u.push(i.data):console.warn(`❌ Offer ${d} not found`)}await e.fetchEditions(),console.log("Available editions:",e.editions);const k=u.map(d=>{var h,w,C,E,P,y,S,N;const i=(h=d.data)==null?void 0:h.edition_id;console.log("Offer edition_id:",i);const r=e.editions.find(A=>A.id===i);return console.log("Edition found:",r),{title:((w=r==null?void 0:r.data)==null?void 0:w.book_title)||((C=d.data)==null?void 0:C.edition_book_name)||"Título desconocido",image:((E=r==null?void 0:r.data)==null?void 0:E.image)||"placeholder.jpg",price:((P=d==null?void 0:d.data)==null?void 0:P.price)||0,condition:((y=d==null?void 0:d.data)==null?void 0:y.condition)||"",type:((S=r==null?void 0:r.data)==null?void 0:S.type)||"",editorial:((N=r==null?void 0:r.data)==null?void 0:N.editorial)||""}});c.value={orderNumber:t.id,buyerName:t.buyer_name||"—",shippingAddress:t.shipping_address||"—",comment:t.comment||"",status:t.status||"Pendiente",totalPrice:t.total_price||0,shippingCost:t.shipping_cost||0,offers:t.offer_ids,books:k,buyerId:t.buyer_id},console.log("📦 Orden cargada:",c.value)}else console.error("❌ Error al cargar la orden:",n==null?void 0:n.message)}),{order:c,marcarComoEnviado:async l=>{window.confirm("¿Estás seguro de que quieres marcar este pedido como enviado?")?(await s.confirmShipment(l),console.log("Pedido marcado como enviado."),window.confirm("¡Envío confirmado correctamente!"),window.location.reload()):console.log("Operación cancelada. El estado del pedido no ha cambiado.")}}}},Y={class:"order-container"},J={class:"panel"},K={class:"panel-row"},Q={class:"value"},W={class:"panel-row"},X={class:"panel-row"},Z={class:"value"},$={class:"panel-row"},oo={class:"value italic"},so={class:"panel-row status-row"},eo={class:"panel"},to={class:"book-table"},ao=["src"],ro={class:"price"},no={class:"panel-row"},io={class:"value price"},lo={class:"panel-row"},co={class:"value price"};function uo(v,s,b,e,g,f){var _,l,n;const c=V("Button");return m(),p(I,null,[s[13]||(s[13]=o("div",{class:"header-skip"},null,-1)),o("div",Y,[s[12]||(s[12]=o("h2",{class:"section-title"},"📦 Gestionar Pedido",-1)),o("div",J,[s[7]||(s[7]=o("h3",{class:"panel-title"},"🧾 Detalles del Pedido",-1)),o("div",K,[s[2]||(s[2]=o("span",{class:"label"},"#️⃣ Número de pedido:",-1)),o("span",Q,a(e.order.orderNumber),1)]),o("div",W,[s[3]||(s[3]=o("span",{class:"label"},"👤 Comprador:",-1)),O(c,{onClick:s[0]||(s[0]=t=>v.$router.push(`/perfil/${e.order.buyerId}`))},{default:B(()=>[z(a(e.order.buyerName),1)]),_:1})]),o("div",X,[s[4]||(s[4]=o("span",{class:"label"},"🏠 Dirección:",-1)),o("span",Z,a((_=e.order.shippingAddress)==null?void 0:_.direccion)+", "+a((l=e.order.shippingAddress)==null?void 0:l.ciudad)+", "+a((n=e.order.shippingAddress)==null?void 0:n.provincia),1)]),o("div",$,[s[5]||(s[5]=o("span",{class:"label"},"📝 Comentario:",-1)),o("span",oo,'"'+a(e.order.comment)+'"',1)]),o("div",so,[s[6]||(s[6]=o("span",{class:"label"},"🔄 Estado:",-1)),o("span",null,a(e.order.status==="PAID"?"Pendiente":e.order.status==="SHIPPED"?"Enviado":e.order.status==="ARRIVED"?"Completado":e.order.status),1),e.order.status==="PAID"?(m(),p("button",{key:0,class:"confirm-button",onClick:s[1]||(s[1]=t=>e.marcarComoEnviado(e.order.orderNumber))}," Marcar como enviado ")):x("",!0)])]),o("div",eo,[s[11]||(s[11]=o("h3",{class:"panel-title"},"📚 Lista de Artículos",-1)),o("table",to,[s[8]||(s[8]=o("thead",null,[o("tr",null,[o("th",null,"Portada"),o("th",null,"Título"),o("th",null,"Tipo"),o("th",null,"Condicion"),o("th",null,"Editorial"),o("th",null,"Precio")])],-1)),o("tbody",null,[(m(!0),p(I,null,T(e.order.books,(t,u)=>(m(),p("tr",{key:u},[o("td",null,[o("img",{src:t.image,alt:"Portada",class:"book-cover"},null,8,ao)]),o("td",null,a(t.title),1),o("td",null,a(t.type),1),o("td",null,a(t.condition),1),o("td",null,a(t.editorial),1),o("td",ro,a(t.price)+" €",1)]))),128))])]),o("div",no,[s[9]||(s[9]=o("span",{class:"label"}," Precio Envio:",-1)),o("span",io,a(e.order.shippingCost)+" €",1)]),o("div",lo,[s[10]||(s[10]=o("span",{class:"label"}," Precio Total:",-1)),o("span",co,a(e.order.totalPrice)+" €",1)])])])],64)}const mo=D(H,[["render",uo],["__scopeId","data-v-2bf3950d"]]);export{mo as default};
