import{_ as Fe,u as be,Y as $e,r as b,l as ye,m as u,z as Ve,ab as ke,p as Y,j as l,e as c,h as Ce,o as V,d as o,a as i,c as L,b as M,t as n,i as p,n as X}from"./index-B0bI5t4i.js";const De={class:"boton-filtrar-contenedor"},we={key:0,class:"filtro-activo"},Me={key:1,class:"filtro-activo"},Ne={class:"bloque-filtro"},xe={class:"rango-precio-dialogo"},Ie={class:"bloque-filtro"},Pe={class:"rango-fechas-dialogo"},Te=["onClick"],Ue={class:"no-datos"},Oe={key:1,class:"sin-ventas"},Le={class:"sin-ventas-p"},ze={class:"resumen-totales"},Re={class:"resumen-totales-p"},Be={__name:"VentasUsuarioView",setup(Ee){const Z=Ce(),j=be(),z=$e(),g=b([]),$=b(""),{t:h}=ye(),d=b(null),S=b(null),v=b(null),_=b(null),k=b([null,null]),f=b([]),N=b(!1);let q=null;const ee=e=>{Z.push(`Perfil/GestionarPedido/${e}`)},ae=u(()=>[{title:h("ventas.idPedido"),value:"id",align:"center",sortable:!0},{title:h("ventas.comprador"),value:"buyer_name",align:"center",sortable:!0},{title:h("ventas.fechaSin"),value:"buying_date",align:"center",sortable:!0},{title:h("ventas.total"),value:"total_price",align:"center",sortable:!0},{title:h("ventas.acciones"),value:"actions",align:"center",sortable:!1}]),R=e=>!e||typeof e.seconds!="number"?null:new Date(e.seconds*1e3),C=e=>e instanceof Date&&!isNaN(e.getTime()),x=u(()=>Math.min(...g.value.map(e=>parseFloat(e.total_price)))),D=u(()=>Math.max(...g.value.map(e=>parseFloat(e.total_price)))),I=u(()=>g.value.every(e=>isNaN(parseFloat(e.total_price)))),m=u(()=>new Date(Math.min(...g.value.map(e=>R(e.buying_date)).filter(e=>e instanceof Date&&!isNaN(e))))),w=u(()=>new Date(Math.max(...g.value.map(e=>R(e.buying_date)).filter(e=>e instanceof Date&&!isNaN(e))))),te=u(()=>I.value?!1:d.value!==null&&(d.value!==x.value||S.value!==D.value)),le=u(()=>{const e=C(m.value)?m.value.toISOString().split("T")[0]:void 0,a=w.value.toISOString().split("T")[0];return v.value&&(v.value!==e||_.value!==a)}),G=u(()=>{const e=d.value!==null&&(d.value!==x.value||S.value!==D.value),a=C(m.value)?m.value.toISOString().split("T")[0]:void 0,s=w.value.toISOString().split("T")[0],r=v.value&&(v.value!==a||_.value!==s);return e||r}),oe=u(()=>{if(d.value==null||S.value==null)return"";const e=parseFloat(d.value).toFixed(2),a=parseFloat(S.value).toFixed(2);return e===a?h("ventas.precioSin")+`: ${e}€`:h("ventas.filtroPrecio")+`: ${e}€ - ${a}€`}),ne=u(()=>{if(!v.value||!_.value)return"";let e=v.value,a=_.value;e>a&&([e,a]=[a,e]);const s=J(e),r=J(a);return s===r?h("ventas.fechaSin")+`: ${s}`:h("ventas.filtroFecha")+`: ${s} - ${r}`}),se=u(()=>E.value.length),B=u(()=>E.value.reduce((e,a)=>e+parseFloat(a.total_price),0).toFixed(2)),y=e=>{if(!e)return"";const a=new Date(e);if(isNaN(a))return"";const s=String(a.getDate()).padStart(2,"0"),r=String(a.getMonth()+1).padStart(2,"0");return`${a.getFullYear()}-${r}-${s}`},J=e=>{if(!e)return"";const a=new Date(e),s=String(a.getDate()).padStart(2,"0"),r=String(a.getMonth()+1).padStart(2,"0"),F=a.getFullYear();return`${s}-${r}-${F}`},E=u(()=>{let e=v.value,a=_.value;e&&a&&e>a&&([e,a]=[a,e]);const s=e?y(e):"",r=a?y(a):"";return g.value.filter(F=>{const A=F.id.toLowerCase().includes($.value.toLowerCase())||F.buyer_name.toLowerCase().includes($.value.toLowerCase()),P=parseFloat(F.total_price),T=R(F.buying_date),U=T?y(T):"",H=I.value||(d.value==null||P>=d.value)&&(S.value==null||P<=S.value),O=(!s||U>=s)&&(!r||U<=r);return A&&H&&O})}),ie=e=>{e.length>2&&(f.value=e.slice(-2))},re=u(()=>{let e=0;return d.value!==null&&(d.value!==x.value||S.value!==D.value)&&e++,v.value&&(y(v.value)!==y(m.value)||y(_.value)!==y(w.value))&&e++,e}),K=()=>{d.value=null,S.value=null,k.value=[x.value,D.value]},Q=()=>{v.value=null,_.value=null,f.value=[]},ue=()=>{K(),Q(),$.value=""},ce=()=>{if(d.value=k.value[0],S.value=k.value[1],f.value.length===2){const e=[...f.value].sort();v.value=e[0],_.value=e[1]}else f.value.length===1?(v.value=f.value[0],_.value=f.value[0]):(v.value=null,_.value=null);N.value=!1},ve=async e=>{await z.confirmShipment(e),console.log("Pedido marcado como enviado.");const a=await z.getSellsFromUser(j.id);(a==null?void 0:a.result)==="SUCCESS"&&(g.value=a.data)},W=async()=>{const e=await z.getSellsFromUser(j.id);(e==null?void 0:e.result)==="SUCCESS"&&(g.value=e.data)};return Ve(async()=>{await W(),q=setInterval(()=>{W()},5e3),k.value=[x.value,D.value],C(m.value)&&C(w.value)?f.value=[m.value.toISOString().split("T")[0],w.value.toISOString().split("T")[0]]:f.value=[]}),ke(()=>{clearInterval(q)}),(e,a)=>{const s=c("v-btn"),r=c("v-icon"),F=c("v-card-title"),A=c("v-range-slider"),P=c("v-date-picker"),T=c("v-card-text"),U=c("v-spacer"),H=c("v-card-actions"),O=c("v-card"),de=c("v-dialog"),pe=c("v-text-field"),fe=c("v-data-table"),me=c("v-col"),_e=c("v-row"),ge=c("v-container");return V(),Y(ge,{class:"ventas-vcontainer"},{default:l(()=>[o(_e,{justify:"center"},{default:l(()=>[o(me,{cols:"12",md:"12"},{default:l(()=>[o(O,{class:"ventas-vcard",elevation:"6"},{default:l(()=>[i("h1",null,n(e.$t("ventas.titulo")),1),i("div",De,[o(s,{onClick:a[0]||(a[0]=t=>N.value=!0),variant:"outlined",class:"boton-filtrar"},{default:l(()=>[p(n(e.$t("ventas.filtrar")),1)]),_:1})]),d.value||v.value?(V(),L("div",{key:0,class:X(["zona-filtros-activos",{oculto:!G.value}])},[te.value?(V(),L("span",we,[p(n(oe.value)+" ",1),o(s,{icon:"",size:"x-small",onClick:K,variant:"text"},{default:l(()=>[o(r,{class:"icono-close-circle"},{default:l(()=>a[8]||(a[8]=[p("mdi-close-circle")])),_:1})]),_:1})])):M("",!0),le.value?(V(),L("span",Me,[p(n(ne.value)+" ",1),o(s,{icon:"",size:"x-small",onClick:Q,variant:"text"},{default:l(()=>[o(r,{class:"icono-close-circle"},{default:l(()=>a[9]||(a[9]=[p("mdi-close-circle")])),_:1})]),_:1})])):M("",!0),G.value&&re.value>1&&!I.value?(V(),Y(s,{key:2,onClick:ue,variant:"outlined",class:"boton-limpiar-filtros"},{default:l(()=>[p(n(e.$t("ventas.limpiarFiltros")),1)]),_:1})):M("",!0)],2)):M("",!0),o(de,{modelValue:N.value,"onUpdate:modelValue":a[4]||(a[4]=t=>N.value=t),width:"400"},{default:l(()=>[o(O,{class:"vcard-dialogo"},{default:l(()=>[o(F,{class:"titulo-dialogo"},{default:l(()=>[p(n(e.$t("ventas.filtrado")),1)]),_:1}),o(T,null,{default:l(()=>[i("div",Ne,[i("p",xe,n(e.$t("ventas.rangoPrecio")),1),o(A,{modelValue:k.value,"onUpdate:modelValue":a[1]||(a[1]=t=>k.value=t),min:C(m.value)?m.value.toISOString().split("T")[0]:void 0,max:D.value,color:"#2c3e50",step:"0.01","thumb-label":"",disabled:I.value},null,8,["modelValue","min","max","disabled"])]),i("div",Ie,[i("p",Pe,n(e.$t("ventas.rangoFechas")),1),o(P,{modelValue:f.value,"onUpdate:modelValue":[a[2]||(a[2]=t=>f.value=t),ie],min:C(m.value.value)?m.value.value.toISOString().split("T")[0]:void 0,max:w.value.toISOString().split("T")[0],multiple:"",color:"#2c3e50"},null,8,["modelValue","min","max"])])]),_:1}),o(H,{class:"acciones-dialogo"},{default:l(()=>[o(U),o(s,{onClick:a[3]||(a[3]=t=>N.value=!1),color:"black"},{default:l(()=>[p(n(e.$t("ventas.cerrar")),1)]),_:1}),o(s,{onClick:ce,color:"#2c3e50"},{default:l(()=>[p(n(e.$t("ventas.aplicar")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),o(pe,{modelValue:$.value,"onUpdate:modelValue":a[5]||(a[5]=t=>$.value=t),placeholder:e.$t("ventas.buscador"),"prepend-inner-icon":"mdi-magnify",class:"buscador","hide-details":"",clearable:"",variant:"outlined","onClick:clear":a[6]||(a[6]=t=>$.value="")},null,8,["modelValue","placeholder"]),o(fe,{search:$.value,"onUpdate:search":a[7]||(a[7]=t=>$.value=t),headers:ae.value,items:E.value,"items-per-page":5,"items-per-page-options":[5,10,20,50,-1],"items-per-page-text":e.$t("tabla.elementosPorPagina"),"items-per-page-all-text":e.$t("tabla.todos"),"sort-by":[{key:"fecha",order:"desc"}],density:"comfortable"},{item:l(({item:t,index:he})=>[i("tr",{class:X(he%2===0?"fila-par":"fila-impar"),onClick:Se=>ee(t.id)},[i("td",null,n(t.id),1),i("td",null,n(t.buyer_name),1),i("td",null,n(new Date(t.buying_date.seconds*1e3).toLocaleDateString()),1),i("td",null,n(isNaN(t.total_price)||t.total_price===null?e.$t("ventas.noDisponible"):t.total_price+" €"),1),i("td",null,[t.status==="PAID"?(V(),Y(s,{key:0,class:"boton-enviar",onClick:Se=>ve(t.id),density:"comfortable"},{default:l(()=>[p(n(e.$t("ventas.marcarEnviado")),1)]),_:2},1032,["onClick"])):M("",!0)])],10,Te)]),"no-data":l(()=>[i("div",Ue,n(e.$t("ventas.noDatos")),1)]),_:1},8,["search","headers","items","items-per-page-text","items-per-page-all-text"]),g.value.length===0?(V(),L("div",Oe,[o(r,{color:"grey",size:"40"},{default:l(()=>a[10]||(a[10]=[p("mdi-book-off")])),_:1}),i("p",Le,n(e.$t("ventas.sinVentas")),1)])):M("",!0),i("div",ze,[i("p",Re,[i("strong",null,n(e.$t("ventas.totalVentas"))+" :",1),p(" "+n(se.value),1)]),i("p",null,[i("strong",null,n(e.$t("ventas.ingresosTotales"))+" :",1),p(" "+n(isNaN(B.value)||B.value===null?e.$t("ventas.noDisponible"):B.value+" €"),1)])])]),_:1})]),_:1})]),_:1})]),_:1})}}},He=Fe(Be,[["__scopeId","data-v-1c75ad2f"]]);export{He as default};
