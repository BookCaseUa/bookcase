import{_ as q,r as v,Y,G as L,c as D,d as n,j as s,e as r,i as S,t as a,a as l,b as k,F as Z,o as m,u as J,B as K,Z as Q,q as W,l as X,m as M,z as x,ab as ee,p as O,n as j,g as oe}from"./index-B0bI5t4i.js";const te={class:"mb-6"},ae={class:"nombre-edicion"},le={key:0,class:"text-error text-caption text-center d-block"},se={class:"nombre-usuario"},ne={key:0,class:"text-error text-caption text-center d-block"},re={__name:"ValoracionPedido",props:{modelValue:Boolean,pedidoId:String,productoNombre:String,vendedorNombre:String},emits:["update:modelValue","valoracionEnviada"],setup(B,{emit:R}){const b=v(0),w=v(0),y=v(""),P=v(!1),u=v(!1),f=v(!1),_=v("Gracias por tu valoración."),A=Y(),C=B,E=R,p=v(C.modelValue);L(()=>C.modelValue,d=>{p.value=d}),L(p,d=>{E("update:modelValue",d)});const F=()=>{p.value=!1},G=async()=>{if(P.value=b.value===0,u.value=w.value===0,P.value||u.value)return;(await A.rateArrivedOrder(C.pedidoId,w.value,b.value,y.value.trim())).result==="SUCCESS"?(_.value="Gracias por tu valoración.",f.value=!0,F()):(_.value="Error al guardar la valoración.",f.value=!0)};return(d,i)=>{const T=r("v-card-title"),U=r("v-rating"),e=r("v-textarea"),t=r("v-card-text"),$=r("v-btn"),I=r("v-card-actions"),g=r("v-card"),h=r("v-dialog"),V=r("v-snackbar");return m(),D(Z,null,[n(h,{modelValue:p.value,"onUpdate:modelValue":i[3]||(i[3]=c=>p.value=c),"max-width":"700",persistent:""},{default:s(()=>[n(g,{class:"valoracion-card"},{default:s(()=>[n(T,{class:"titulo"},{default:s(()=>[S(a(d.$t("pedidos.valoraciones.titulo")),1)]),_:1}),n(t,null,{default:s(()=>[l("div",te,[l("div",ae,[l("span",null,a(B.productoNombre),1)]),n(U,{class:"rating",modelValue:b.value,"onUpdate:modelValue":i[0]||(i[0]=c=>b.value=c),length:"5",color:"amber","background-color":"grey lighten-2","half-increments":"",hover:""},null,8,["modelValue"]),P.value?(m(),D("span",le,a(d.$t("pedidos.valoraciones.errorProducto")),1)):k("",!0)]),l("div",null,[l("div",se,[l("span",null,a(B.vendedorNombre),1)]),n(U,{class:"rating",modelValue:w.value,"onUpdate:modelValue":i[1]||(i[1]=c=>w.value=c),length:"5",color:"amber","background-color":"grey lighten-2","half-increments":"",hover:""},null,8,["modelValue"]),u.value?(m(),D("span",ne,a(d.$t("pedidos.valoraciones.errorVendedor")),1)):k("",!0),n(e,{modelValue:y.value,"onUpdate:modelValue":i[2]||(i[2]=c=>y.value=c),label:d.$t("pedidos.valoraciones.comentarioPlaceholder"),hint:d.$t("pedidos.valoraciones.comentarioAyuda"),"persistent-hint":"",rows:"2","auto-grow":"",density:"comfortable",class:"comentario"},null,8,["modelValue","label","hint"])])]),_:1}),n(I,null,{default:s(()=>[n($,{class:"boton-enviar",variant:"text",onClick:G},{default:s(()=>[S(a(d.$t("pedidos.valoraciones.enviar")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),n(V,{modelValue:f.value,"onUpdate:modelValue":i[4]||(i[4]=c=>f.value=c),color:"#2c3e50",timeout:"2000",location:"center",rounded:"pill"},{default:s(()=>[S(a(_.value),1)]),_:1},8,["modelValue"])],64)}}},de=q(re,[["__scopeId","data-v-ca9917b3"]]),ie={class:"titulo"},ue={key:0,class:"sin-pedidos"},ce={key:0,class:"sin-pedidos"},ve={__name:"PedidosUsuarioView",setup(B){const R=J(),b=Y(),w=K(),y=Q(),P=W(),{t:u}=X(),f=v(0),_=v([]),A=v({});let C=null;const E=v(!1),p=v(null),F=M(()=>[{title:u("pedidos.pedido"),value:"id",align:"center",sortable:!0},{title:u("pedidos.vendedor"),value:"seller_name",align:"center",sortable:!0},{title:u("pedidos.fecha"),value:"fecha",align:"center",sortable:!0},{title:"Total",value:"total",align:"center",sortable:!0},{title:u("pedidos.estado"),value:"status",align:"center",sortable:!0},{title:u("pedidos.acciones"),value:"acciones",align:"center",sortable:!1}]),G=M(()=>[{title:u("pedidos.pedido"),value:"id",align:"center",sortable:!0},{title:u("pedidos.vendedor"),value:"seller_name",align:"center",sortable:!0},{title:u("pedidos.fecha"),value:"fecha",align:"center",sortable:!0},{title:"Total",value:"total",align:"center",sortable:!0},{title:u("pedidos.acciones"),value:"acciones",align:"center",sortable:!1}]),d=M(()=>_.value.filter(e=>e.status==="PAID"||e.status==="SHIPPED").map(e=>({...e,fecha:new Date(e.buying_date.seconds*1e3)}))),i=M(()=>_.value.filter(e=>e.status==="ARRIVED").map(e=>({...e,fecha:new Date(e.buying_date.seconds*1e3)}))),T=async e=>{const t=await b.confirmArrival(e.id);t.result==="SUCCESS"?(console.log("Pedido marcado como recibido..."),p.value=e,E.value=!0,await U()):console.warn("Error al marcar como recibido:",t.message)},U=async()=>{await b.fetchOrders();const e=await b.getPurchasesFromUser(R.id);if(await P.getEditions(),await y.getBooks(),(e==null?void 0:e.result)==="SUCCESS"){_.value=e.data,console.log("Pedidos obtenidos: ",_.value);for(const t of _.value){const $=[];for(const I of t.offer_ids){const g=await w.getOffer(I);if(g.result==="SUCCESS"){const h=g.data,V=P.editions.find(N=>N.id===h.data.edition_id),c=V?y.books.find(N=>N.id===V.data.book_id):null;$.push({offer:h,edition:V,book:c})}}A.value[t.id]=$,console.log(`Detalles del pedido ${t.id}: `,A.value)}}};return x(()=>{U(),C=setInterval(U,5e3)}),ee(()=>{clearInterval(C)}),(e,t)=>{const $=r("v-tab"),I=r("v-tabs"),g=r("v-icon"),h=r("v-data-table"),V=r("v-window-item"),c=r("v-window"),N=r("v-container");return m(),D(Z,null,[n(N,{class:"pa-5"},{default:s(()=>[l("h2",ie,a(e.$t("pedidos.titulo")),1),n(I,{modelValue:f.value,"onUpdate:modelValue":t[0]||(t[0]=o=>f.value=o),density:"comfortable",class:"mb-2"},{default:s(()=>[n($,null,{default:s(()=>[S(a(e.$t("pedidos.activos")),1)]),_:1}),n($,null,{default:s(()=>[S(a(e.$t("pedidos.completados")),1)]),_:1})]),_:1},8,["modelValue"]),n(c,{modelValue:f.value,"onUpdate:modelValue":t[1]||(t[1]=o=>f.value=o)},{default:s(()=>[n(V,{value:"activos"},{default:s(()=>[d.value.length===0?(m(),D("div",ue,a(e.$t("pedidos.sinPedidosActivos")),1)):k("",!0),d.value.length>0?(m(),O(h,{key:1,headers:F.value,items:d.value,"items-per-page":5,"items-per-page-options":[5,10,20,50,-1],class:"mt-4"},{item:s(({item:o,index:z})=>[l("tr",{class:j(z%2===0?"fila-par":"fila-impar")},[l("td",null,a(o.id),1),l("td",null,a(o.seller_name),1),l("td",null,a(o.fecha.toLocaleDateString()),1),l("td",null,a(isNaN(o.total_price)?e.$t("pedidos.noDisponible"):o.total_price+" €"),1),l("td",null,a(e.$t(`pedidos.estados.${o.status}`)),1),l("td",null,[o.status==="SHIPPED"?(m(),O(g,{key:0,color:"success",class:"mr-2",title:e.$t("pedidos.marcarRecibido"),onClick:oe(H=>T(o),["stop"])},{default:s(()=>t[3]||(t[3]=[S(" mdi-check-circle ")])),_:2},1032,["title","onClick"])):k("",!0),n(g,{color:"primary",title:e.$t("pedidos.verDetalles"),onClick:H=>e.$router.push(`/perfil/VerPedido/${o.id}`)},{default:s(()=>t[4]||(t[4]=[S(" mdi-magnify ")])),_:2},1032,["title","onClick"])])],2)]),_:1},8,["headers","items"])):k("",!0)]),_:1}),n(V,{value:"completados"},{default:s(()=>[i.value.length===0?(m(),D("div",ce,a(e.$t("pedidos.sinPedidosCompletados")),1)):k("",!0),i.value.length>0?(m(),O(h,{key:1,headers:G.value,items:i.value,"items-per-page":5,"items-per-page-options":[5,10,20,50,-1],class:"mt-4"},{item:s(({item:o,index:z})=>[l("tr",{class:j(z%2===0?"fila-par":"fila-impar")},[l("td",null,a(o.id),1),l("td",null,a(o.seller_name),1),l("td",null,a(o.fecha.toLocaleDateString()),1),l("td",null,a(isNaN(o.total_price)?e.$t("pedidos.noDisponible"):o.total_price+" €"),1),l("td",null,[n(g,{color:"primary",title:e.$t("pedidos.verDetalles"),onClick:H=>e.$router.push(`/perfil/VerPedido/${o.id}`)},{default:s(()=>t[5]||(t[5]=[S(" mdi-magnify ")])),_:2},1032,["title","onClick"])])],2)]),_:1},8,["headers","items"])):k("",!0)]),_:1})]),_:1},8,["modelValue"])]),_:1}),p.value?(m(),O(de,{key:0,modelValue:E.value,"onUpdate:modelValue":t[2]||(t[2]=o=>E.value=o),"pedido-id":p.value.id,"producto-nombre":e.$t("pedidos.valoraciones.productoMultiple"),"vendedor-nombre":p.value.seller_name},null,8,["modelValue","pedido-id","producto-nombre","vendedor-nombre"])):k("",!0)],64)}}},me=q(ve,[["__scopeId","data-v-c3519823"]]);export{me as default};
