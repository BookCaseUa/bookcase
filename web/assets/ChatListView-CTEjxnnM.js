import{_ as lt,u as nt,l as it,r as f,m as rt,z as ct,p as D,j as a,ak as dt,aq as q,ar as M,as as R,e as i,al as U,h as ut,o as b,a as d,d as s,c as P,b as G,t as l,F as vt,x as mt,D as A,n as _t,i as n,g as I,$ as ft,ai as j,an as z,at as pt}from"./index-B0bI5t4i.js";const ht={class:"text-h5 mb-6 text-center"},bt={class:"d-flex align-center"},yt={class:"text-grey mr-2"},$t={key:0,class:"text-center mt-10"},gt={class:"text-grey mt-2"},Ct={class:"text-center mb-4"},kt={__name:"ChatListView",setup(wt){const r=nt(),H=ut(),{t:y}=it(),g=f(!1),C=f(""),E=f([]),F=f({}),L=f(""),S=f(!1),k=f(!1),w=f(null),T=async()=>{var $;const t=dt(U,"chats"),e=q(t,M("buyer_id","==",r.id)),u=q(t,M("seller_id","==",r.id)),[p,v]=await Promise.all([R(e),R(u)]),m=[...p.docs,...v.docs];E.value=m.map(c=>({id:c.id,...c.data()})).sort((c,h)=>{var _,V;return((_=h.updated_at)==null?void 0:_.seconds)-((V=c.updated_at)==null?void 0:V.seconds)});for(const c of E.value){const h=c.buyer_id===r.id?c.seller_id:c.buyer_id;if(!F.value[h]){const _=await r.fetchUserById(h);F.value[h]=(($=_==null?void 0:_.data)==null?void 0:$.nickname)||y("chats.usuario")}}},B=rt(()=>E.value.filter(t=>{var m;if(t.deletedFor&&t.deletedFor.includes(r.id))return!1;const e=t.buyer_id===r.id?t.seller_id:t.buyer_id,u=((m=F.value[e])==null?void 0:m.toLowerCase())||"",p=`archived_by_${r.id}`,v=t[p]===!0;return u.includes(L.value.toLowerCase())&&(S.value||!v)}));function J(t){const e=t.buyer_id===r.id?t.seller_id:t.buyer_id;return F.value[e]||y("chats.usuario")}async function K(t){const e=j(U,"chats",t);await z(e,{[`archived_by_${r.id}`]:!0}),C.value=y("chats.chatArchivado"),g.value=!0,await T()}async function O(t){const e=j(U,"chats",t);await z(e,{[`archived_by_${r.id}`]:!1}),C.value=y("chats.chatDesarchivado"),g.value=!0,await T()}function Q(t){w.value=t,k.value=!0}async function W(){if(!w.value)return;const t=j(U,"chats",w.value),e=E.value.find(p=>p.id===w.value),u=[...(e==null?void 0:e.deletedFor)||[],r.id];u.length>=2?(await pt(t),C.value=y("chats.chatEliminadoDefinitivamente")):(await z(t,{deletedFor:u}),C.value=y("chats.chatEliminado")),g.value=!0,k.value=!1,w.value=null,await T()}function X(t){H.push(`/chat/${t}`)}function Y(t){if(!t)return"?";const e=t.toDate();return e.toLocaleDateString()+" "+e.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}return ct(T),(t,e)=>{const u=i("v-text-field"),p=i("v-switch"),v=i("v-icon"),m=i("v-btn"),$=i("v-list-item-title"),c=i("v-list-item"),h=i("v-list"),_=i("v-menu"),V=i("v-card-title"),Z=i("v-card-subtitle"),N=i("v-card"),tt=i("v-snackbar"),et=i("v-card-text"),at=i("v-card-actions"),st=i("v-dialog"),ot=i("v-container");return b(),D(ot,{class:"py-10"},{default:a(()=>[d("h2",ht,l(t.$t("chats.titulo")),1),s(u,{modelValue:L.value,"onUpdate:modelValue":e[0]||(e[0]=o=>L.value=o),label:t.$t("chats.buscarUsuario"),"prepend-icon":"mdi-magnify",class:"mb-4"},null,8,["modelValue","label"]),s(p,{modelValue:S.value,"onUpdate:modelValue":e[1]||(e[1]=o=>S.value=o),label:t.$t("chats.mostrarArchivados"),inset:"",color:"primary",class:"mb-6"},null,8,["modelValue","label"]),(b(!0),P(vt,null,mt(B.value,o=>(b(),D(N,{key:o.id,class:_t(["mb-4 chat-card",{"chat-card-archivado":o[`archived_by_${A(r).id}`]}]),elevation:o[`archived_by_${A(r).id}`]?2:6,onClick:x=>X(o.id)},{default:a(()=>[s(V,{class:"d-flex justify-space-between align-center"},{default:a(()=>[d("div",null,[n(" ðŸ’¬ "+l(t.$t("chats.chatCon"))+" ",1),d("strong",null,l(J(o)),1),o[`archived_by_${A(r).id}`]?(b(),D(v,{key:0,size:"16",class:"ml-1"},{default:a(()=>e[6]||(e[6]=[n(" mdi-archive ")])),_:1})):G("",!0)]),d("div",bt,[d("small",yt,l(Y(o.updated_at)),1),s(_,null,{activator:a(({props:x})=>[s(m,ft({icon:"",class:"menu-movil-btn",ref_for:!0},x,{onClick:e[2]||(e[2]=I(()=>{},["stop"]))}),{default:a(()=>[s(v,null,{default:a(()=>e[7]||(e[7]=[n("mdi-dots-vertical")])),_:1})]),_:2},1040)]),default:a(()=>[s(h,null,{default:a(()=>[o[`archived_by_${A(r).id}`]?(b(),D(c,{key:1,onClick:I(x=>O(o.id),["stop"])},{default:a(()=>[s($,null,{default:a(()=>[n(l(t.$t("chats.desarchivar")),1)]),_:1})]),_:2},1032,["onClick"])):(b(),D(c,{key:0,onClick:I(x=>K(o.id),["stop"])},{default:a(()=>[s($,null,{default:a(()=>[n(l(t.$t("chats.archivar")),1)]),_:1})]),_:2},1032,["onClick"])),s(c,{onClick:I(x=>Q(o.id),["stop"])},{default:a(()=>[s($,{class:"text-error"},{default:a(()=>[n(l(t.$t("chats.eliminar")),1)]),_:1})]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)])]),_:2},1024),s(Z,{class:"text-truncate px-4"},{default:a(()=>[n(l(t.$t("chats.ultimoMensaje")+(o.last_message||"...")),1)]),_:2},1024)]),_:2},1032,["elevation","class","onClick"]))),128)),B.value.length===0?(b(),P("div",$t,[s(v,{color:"grey",size:"40"},{default:a(()=>e[8]||(e[8]=[n("mdi-message-off-outline")])),_:1}),d("p",gt,l(t.$t("chats.sinConversacionesActivas")),1)])):G("",!0),s(tt,{modelValue:g.value,"onUpdate:modelValue":e[3]||(e[3]=o=>g.value=o),timeout:"3000",color:"success"},{default:a(()=>[n(l(C.value),1)]),_:1},8,["modelValue"]),s(st,{modelValue:k.value,"onUpdate:modelValue":e[5]||(e[5]=o=>k.value=o),width:"400",persistent:""},{default:a(()=>[s(N,{class:"pa-4"},{default:a(()=>[d("div",Ct,[s(v,{size:"48",color:"error"},{default:a(()=>e[9]||(e[9]=[n("mdi-trash-can-outline")])),_:1})]),s(V,{class:"justify-center text-h6 font-weight-bold"},{default:a(()=>[n(l(t.$t("chats.confirmarEliminarTitulo")),1)]),_:1}),s(et,{class:"text-center text-body-2"},{default:a(()=>[n(l(t.$t("chats.confirmarEliminarTexto1"))+" ",1),d("strong",null,l(t.$t("chats.confirmarEliminarTexto2")),1),e[10]||(e[10]=n(".")),e[11]||(e[11]=d("br",null,null,-1)),n(" "+l(t.$t("chats.confirmarEliminarTexto3"))+" ",1),d("strong",null,l(t.$t("chats.confirmarEliminarTexto4")),1),e[12]||(e[12]=n(". "))]),_:1}),s(at,{class:"justify-center mt-4"},{default:a(()=>[s(m,{text:"",onClick:e[4]||(e[4]=o=>k.value=!1),class:"mr-2"},{default:a(()=>[n(l(t.$t("chats.cancelar")),1)]),_:1}),s(m,{color:"error",variant:"flat",onClick:W},{default:a(()=>[n(l(t.$t("chats.eliminar")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}}},xt=lt(kt,[["__scopeId","data-v-9af7f985"]]);export{xt as default};
