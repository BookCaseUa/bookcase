import{_ as pt,u as ht,l as gt,E as yt,r as K,m as se,ac as qt,y as Ve,z as Je,ad as bt,ab as We,c as G,a as D,d as U,j as V,e as Z,b as fe,t as oe,ae as Yt,F as le,x as Ce,n as be,D as x,i as J,p as Ie,w as vt,g as De,v as kt,af as Et,ag as wt,ah as _t,ai as ae,aj as Tt,ak as jt,al as Q,am as St,an as me,ao as $e,o as B,ap as xt,T as Xt,A as Zt}from"./index-B0bI5t4i.js";function _e(t){if(typeof t!="string"||!t)throw new Error("expected a non-empty string, got: "+t)}function Be(t){if(typeof t!="number")throw new Error("expected a number, got: "+t)}const Jt=1,Qt=1,de="emoji",he="keyvalue",Qe="favorites",en="tokens",Ct="tokens",tn="unicode",It="count",nn="group",on="order",Dt="group-order",He="eTag",Le="url",it="skinTone",ge="readonly",et="readwrite",$t="skinUnicodes",rn="skinUnicodes",sn="https://cdn.jsdelivr.net/npm/emoji-picker-element-data@^1/en/emojibase/data.json",an="en";function cn(t,e){const n=new Set,i=[];for(const r of t){const o=e(r);n.has(o)||(n.add(o),i.push(r))}return i}function rt(t){return cn(t,e=>e.unicode)}function ln(t){function e(n,i,r){const o=i?t.createObjectStore(n,{keyPath:i}):t.createObjectStore(n);if(r)for(const[a,[l,p]]of Object.entries(r))o.createIndex(a,l,{multiEntry:p});return o}e(he),e(de,tn,{[Ct]:[en,!0],[Dt]:[[nn,on]],[$t]:[rn,!0]}),e(Qe,void 0,{[It]:[""]})}const qe={},Se={},Me={};function Lt(t,e,n){n.onerror=()=>e(n.error),n.onblocked=()=>e(new Error("IDB blocked")),n.onsuccess=()=>t(n.result)}async function un(t){const e=await new Promise((n,i)=>{const r=indexedDB.open(t,Jt);qe[t]=r,r.onupgradeneeded=o=>{o.oldVersion<Qt&&ln(r.result)},Lt(n,i,r)});return e.onclose=()=>tt(t),e}function dn(t){return Se[t]||(Se[t]=un(t)),Se[t]}function ie(t,e,n,i){return new Promise((r,o)=>{const a=t.transaction(e,n,{durability:"relaxed"}),l=typeof e=="string"?a.objectStore(e):e.map(c=>a.objectStore(c));let p;i(l,a,c=>{p=c}),a.oncomplete=()=>r(p),a.onerror=()=>o(a.error)})}function tt(t){const e=qe[t],n=e&&e.result;if(n){n.close();const i=Me[t];if(i)for(const r of i)r()}delete qe[t],delete Se[t],delete Me[t]}function fn(t){return new Promise((e,n)=>{tt(t);const i=indexedDB.deleteDatabase(t);Lt(e,n,i)})}function mn(t,e){let n=Me[t];n||(n=Me[t]=[]),n.push(e)}const pn=new Set([":D","XD",":'D","O:)",":X",":P",";P","XP",":L",":Z",":j","8D","XO","8)",":B",":O",":S",":'o","Dx","X(","D:",":C",">0)",":3","</3","<3","\\M/",":E","8#"]);function pe(t){return t.split(/[\s_]+/).map(e=>!e.match(/\w/)||pn.has(e)?e.toLowerCase():e.replace(/[)(:,]/g,"").replace(/‚Äô/g,"'").toLowerCase()).filter(Boolean)}const hn=2;function Mt(t){return t.filter(Boolean).map(e=>e.toLowerCase()).filter(e=>e.length>=hn)}function gn(t){return t.map(({annotation:n,emoticon:i,group:r,order:o,shortcodes:a,skins:l,tags:p,emoji:c,version:d})=>{const y=[...new Set(Mt([...(a||[]).map(pe).flat(),...(p||[]).map(pe).flat(),...pe(n),i]))].sort(),f={annotation:n,group:r,order:o,tags:p,tokens:y,unicode:c,version:d};if(i&&(f.emoticon=i),a&&(f.shortcodes=a),l){f.skinTones=[],f.skinUnicodes=[],f.skinVersions=[];for(const{tone:b,emoji:j,version:C}of l)f.skinTones.push(b),f.skinUnicodes.push(j),f.skinVersions.push(C)}return f})}function At(t,e,n,i){t[e](n).onsuccess=r=>i&&i(r.target.result)}function ue(t,e,n){At(t,"get",e,n)}function Ot(t,e,n){At(t,"getAll",e,n)}function nt(t){t.commit&&t.commit()}function yn(t,e){let n=t[0];for(let i=1;i<t.length;i++){const r=t[i];e(n)>e(r)&&(n=r)}return n}function Pt(t,e){const n=yn(t,r=>r.length),i=[];for(const r of n)t.some(o=>o.findIndex(a=>e(a)===e(r))===-1)||i.push(r);return i}async function bn(t){return!await ot(t,he,Le)}async function vn(t,e,n){const[i,r]=await Promise.all([He,Le].map(o=>ot(t,he,o)));return i===n&&r===e}async function kn(t,e){return ie(t,de,ge,(i,r,o)=>{let a;const l=()=>{i.getAll(a&&IDBKeyRange.lowerBound(a,!0),50).onsuccess=p=>{const c=p.target.result;for(const d of c)if(a=d.unicode,e(d))return o(d);if(c.length<50)return o();l()}};l()})}async function Bt(t,e,n,i){try{const r=gn(e);await ie(t,[de,he],et,([o,a],l)=>{let p,c,d=0;function y(){++d===2&&f()}function f(){if(!(p===i&&c===n)){o.clear();for(const b of r)o.put(b);a.put(i,He),a.put(n,Le),nt(l)}}ue(a,He,b=>{p=b,y()}),ue(a,Le,b=>{c=b,y()})})}finally{}}async function En(t,e){return ie(t,de,ge,(n,i,r)=>{const o=IDBKeyRange.bound([e,0],[e+1,0],!1,!0);Ot(n.index(Dt),o,r)})}async function Rt(t,e){const n=Mt(pe(e));return n.length?ie(t,de,ge,(i,r,o)=>{const a=[],l=()=>{a.length===n.length&&p()},p=()=>{const c=Pt(a,d=>d.unicode);o(c.sort((d,y)=>d.order<y.order?-1:1))};for(let c=0;c<n.length;c++){const d=n[c],y=c===n.length-1?IDBKeyRange.bound(d,d+"Ôøø",!1,!0):IDBKeyRange.only(d);Ot(i.index(Ct),y,f=>{a.push(f),l()})}}):[]}async function wn(t,e){const n=await Rt(t,e);return n.length?n.filter(i=>(i.shortcodes||[]).map(o=>o.toLowerCase()).includes(e.toLowerCase()))[0]||null:await kn(t,r=>(r.shortcodes||[]).includes(e.toLowerCase()))||null}async function _n(t,e){return ie(t,de,ge,(n,i,r)=>ue(n,e,o=>{if(o)return r(o);ue(n.index($t),e,a=>r(a||null))}))}function ot(t,e,n){return ie(t,e,ge,(i,r,o)=>ue(i,n,o))}function Tn(t,e,n,i){return ie(t,e,et,(r,o)=>{r.put(i,n),nt(o)})}function jn(t,e){return ie(t,Qe,et,(n,i)=>ue(n,e,r=>{n.put((r||0)+1,e),nt(i)}))}function Sn(t,e,n){return n===0?[]:ie(t,[Qe,de],ge,([i,r],o,a)=>{const l=[];i.index(It).openCursor(void 0,"prev").onsuccess=p=>{const c=p.target.result;if(!c)return a(l);function d(b){if(l.push(b),l.length===n)return a(l);c.continue()}const y=c.primaryKey,f=e.byName(y);if(f)return d(f);ue(r,y,b=>{if(b)return d(b);c.continue()})}})}const Te="";function xn(t,e){const n=new Map;for(const r of t){const o=e(r);for(const a of o){let l=n;for(let c=0;c<a.length;c++){const d=a.charAt(c);let y=l.get(d);y||(y=new Map,l.set(d,y)),l=y}let p=l.get(Te);p||(p=[],l.set(Te,p)),p.push(r)}}return(r,o)=>{let a=n;for(let c=0;c<r.length;c++){const d=r.charAt(c),y=a.get(d);if(y)a=y;else return[]}if(o)return a.get(Te)||[];const l=[],p=[a];for(;p.length;){const d=[...p.shift().entries()].sort((y,f)=>y[0]<f[0]?-1:1);for(const[y,f]of d)y===Te?l.push(...f):p.push(f)}return l}}const Cn=["name","url"];function In(t){const e=t&&Array.isArray(t),n=e&&t.length&&(!t[0]||Cn.some(i=>!(i in t[0])));if(!e||n)throw new Error("Custom emojis are in the wrong format")}function st(t){In(t);const e=(f,b)=>f.name.toLowerCase()<b.name.toLowerCase()?-1:1,n=t.sort(e),r=xn(t,f=>{const b=new Set;if(f.shortcodes)for(const j of f.shortcodes)for(const C of pe(j))b.add(C);return b}),o=f=>r(f,!0),a=f=>r(f,!1),l=f=>{const b=pe(f),j=b.map((C,A)=>(A<b.length-1?o:a)(C));return Pt(j,C=>C.name).sort(e)},p=new Map,c=new Map;for(const f of t){c.set(f.name.toLowerCase(),f);for(const b of f.shortcodes||[])p.set(b.toLowerCase(),f)}return{all:n,search:l,byShortcode:f=>p.get(f.toLowerCase()),byName:f=>c.get(f.toLowerCase())}}const Dn=typeof wrappedJSObject<"u";function ye(t){if(!t)return t;if(Dn&&(t=structuredClone(t)),delete t.tokens,t.skinTones){const e=t.skinTones.length;t.skins=Array(e);for(let n=0;n<e;n++)t.skins[n]={tone:t.skinTones[n],unicode:t.skinUnicodes[n],version:t.skinVersions[n]};delete t.skinTones,delete t.skinUnicodes,delete t.skinVersions}return t}function Ft(t){t||console.warn("emoji-picker-element is more efficient if the dataSource server exposes an ETag header.")}const $n=["annotation","emoji","group","order","version"];function Ln(t){if(!t||!Array.isArray(t)||!t[0]||typeof t[0]!="object"||$n.some(e=>!(e in t[0])))throw new Error("Emoji data is in the wrong format")}function zt(t,e){if(Math.floor(t.status/100)!==2)throw new Error("Failed to fetch: "+e+":  "+t.status)}async function Mn(t){const e=await fetch(t,{method:"HEAD"});zt(e,t);const n=e.headers.get("etag");return Ft(n),n}async function Ye(t){const e=await fetch(t);zt(e,t);const n=e.headers.get("etag");Ft(n);const i=await e.json();return Ln(i),[n,i]}function An(t){for(var e="",n=new Uint8Array(t),i=n.byteLength,r=-1;++r<i;)e+=String.fromCharCode(n[r]);return e}function On(t){for(var e=t.length,n=new ArrayBuffer(e),i=new Uint8Array(n),r=-1;++r<e;)i[r]=t.charCodeAt(r);return n}async function Nt(t){const e=JSON.stringify(t);let n=On(e);const i=await crypto.subtle.digest("SHA-1",n),r=An(i);return btoa(r)}async function Pn(t,e){let n,i=await Mn(e);if(!i){const r=await Ye(e);i=r[0],n=r[1],i||(i=await Nt(n))}await vn(t,e,i)||(n||(n=(await Ye(e))[1]),await Bt(t,n,e,i))}async function Bn(t,e){let[n,i]=await Ye(e);n||(n=await Nt(i)),await Bt(t,i,e,n)}async function Rn(t,e){try{await Pn(t,e)}catch(n){if(n.name!=="InvalidStateError")throw n}}class Fn{constructor({dataSource:e=sn,locale:n=an,customEmoji:i=[]}={}){this.dataSource=e,this.locale=n,this._dbName=`emoji-picker-element-${this.locale}`,this._db=void 0,this._lazyUpdate=void 0,this._custom=st(i),this._clear=this._clear.bind(this),this._ready=this._init()}async _init(){const e=this._db=await dn(this._dbName);mn(this._dbName,this._clear);const n=this.dataSource;await bn(e)?await Bn(e,n):this._lazyUpdate=Rn(e,n)}async ready(){const e=async()=>(this._ready||(this._ready=this._init()),this._ready);await e(),this._db||await e()}async getEmojiByGroup(e){return Be(e),await this.ready(),rt(await En(this._db,e)).map(ye)}async getEmojiBySearchQuery(e){_e(e),await this.ready();const n=this._custom.search(e),i=rt(await Rt(this._db,e)).map(ye);return[...n,...i]}async getEmojiByShortcode(e){_e(e),await this.ready();const n=this._custom.byShortcode(e);return n||ye(await wn(this._db,e))}async getEmojiByUnicodeOrName(e){_e(e),await this.ready();const n=this._custom.byName(e);return n||ye(await _n(this._db,e))}async getPreferredSkinTone(){return await this.ready(),await ot(this._db,he,it)||0}async setPreferredSkinTone(e){return Be(e),await this.ready(),Tn(this._db,he,it,e)}async incrementFavoriteEmojiCount(e){return _e(e),await this.ready(),jn(this._db,e)}async getTopFavoriteEmoji(e){return Be(e),await this.ready(),(await Sn(this._db,this._custom,e)).map(ye)}set customEmoji(e){this._custom=st(e)}get customEmoji(){return this._custom.all}async _shutdown(){await this.ready();try{await this._lazyUpdate}catch{}}_clear(){this._db=this._ready=this._lazyUpdate=void 0}async close(){await this._shutdown(),await tt(this._dbName)}async delete(){await this._shutdown(),await fn(this._dbName)}}const Xe=[[-1,"‚ú®","custom"],[0,"üòÄ","smileys-emotion"],[1,"üëã","people-body"],[3,"üê±","animals-nature"],[4,"üçé","food-drink"],[5,"üè†Ô∏è","travel-places"],[6,"‚öΩ","activities"],[7,"üìù","objects"],[8,"‚õîÔ∏è","symbols"],[9,"üèÅ","flags"]].map(([t,e,n])=>({id:t,emoji:e,name:n})),Re=Xe.slice(1),zn=2,at=6,Ut=typeof requestIdleCallback=="function"?requestIdleCallback:setTimeout;function ct(t){return t.unicode.includes("‚Äç")}const Nn={"ü´©":16,"ü´®":15.1,"ü´†":14,"ü•≤":13.1,"ü•ª":12.1,"ü•∞":11,"ü§©":5,"üë±‚Äç‚ôÄÔ∏è":4,"ü§£":3,"üëÅÔ∏è‚Äçüó®Ô∏è":2,"üòÄ":1,"üòêÔ∏è":.7,"üòÉ":.6},Un=1e3,Kn="üñêÔ∏è",Gn=8,Vn=["üòä","üòí","‚ù§Ô∏è","üëçÔ∏è","üòç","üòÇ","üò≠","‚ò∫Ô∏è","üòî","üò©","üòè","üíï","üôå","üòò"],Kt='"Twemoji Mozilla","Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji","EmojiOne Color","Android Emoji",sans-serif',Wn=(t,e)=>t<e?-1:t>e?1:0,lt=(t,e)=>{const n=document.createElement("canvas");n.width=n.height=1;const i=n.getContext("2d",{willReadFrequently:!0});return i.textBaseline="top",i.font=`100px ${Kt}`,i.fillStyle=e,i.scale(.01,.01),i.fillText(t,0,0),i.getImageData(0,0,1,1).data},Hn=(t,e)=>{const n=[...t].join(","),i=[...e].join(",");return n===i&&!n.startsWith("0,0,0,")};function qn(t){const e=lt(t,"#000"),n=lt(t,"#fff");return e&&n&&Hn(e,n)}function Yn(){const t=Object.entries(Nn);try{for(const[e,n]of t)if(qn(e))return n}catch{}finally{}return t[0][1]}let Fe;const ze=()=>(Fe||(Fe=new Promise(t=>Ut(()=>t(Yn())))),Fe),Ze=new Map,Xn="Ô∏è",Zn="\uD83C",Jn="‚Äç",Qn=127995,eo=57339;function to(t,e){if(e===0)return t;const n=t.indexOf(Jn);return n!==-1?t.substring(0,n)+String.fromCodePoint(Qn+e-1)+t.substring(n):(t.endsWith(Xn)&&(t=t.substring(0,t.length-1)),t+Zn+String.fromCodePoint(eo+e-1))}function X(t){t.preventDefault(),t.stopPropagation()}function Ne(t,e,n){return e+=t?-1:1,e<0?e=n.length-1:e>=n.length&&(e=0),e}function Gt(t,e){const n=new Set,i=[];for(const r of t){const o=e(r);n.has(o)||(n.add(o),i.push(r))}return i}function no(t,e){const n=i=>{const r={};for(const o of i)typeof o.tone=="number"&&o.version<=e&&(r[o.tone]=o.unicode);return r};return t.map(({unicode:i,skins:r,shortcodes:o,url:a,name:l,category:p,annotation:c})=>({unicode:i,name:l,shortcodes:o,url:a,category:p,annotation:c,id:i||l,skins:r&&n(r)}))}const xe=requestAnimationFrame;let oo=typeof ResizeObserver=="function";function io(t,e,n){let i;oo?(i=new ResizeObserver(n),i.observe(t)):xe(n),e.addEventListener("abort",()=>{i&&i.disconnect()})}function ut(t){{const e=document.createRange();return e.selectNode(t.firstChild),e.getBoundingClientRect().width}}let Ue;function ro(t,e,n){let i=!0;for(const r of t){const o=n(r);if(!o)continue;const a=ut(o);typeof Ue>"u"&&(Ue=ut(e));const l=a/1.8<Ue;Ze.set(r.unicode,l),l||(i=!1)}return i}function so(t){return Gt(t,e=>e)}function ao(t){t&&(t.scrollTop=0)}function ve(t,e,n){let i=t.get(e);return i||(i=n(),t.set(e,i)),i}function dt(t){return""+t}function co(t){const e=document.createElement("template");return e.innerHTML=t,e}const lo=new WeakMap,uo=new WeakMap,fo=Symbol("un-keyed"),mo="replaceChildren"in Element.prototype;function po(t,e){mo?t.replaceChildren(...e):(t.innerHTML="",t.append(...e))}function ho(t,e){let n=t.firstChild,i=0;for(;n;){if(e[i]!==n)return!0;n=n.nextSibling,i++}return i!==e.length}function go(t,e){const{targetNode:n}=e;let{targetParentNode:i}=e,r=!1;i?r=ho(i,t):(r=!0,e.targetNode=void 0,e.targetParentNode=i=n.parentNode),r&&po(i,t)}function yo(t,e){for(const n of e){const{targetNode:i,currentExpression:r,binding:{expressionIndex:o,attributeName:a,attributeValuePre:l,attributeValuePost:p}}=n,c=t[o];if(r!==c)if(n.currentExpression=c,a)if(c===null)i.removeAttribute(a);else{const d=l+dt(c)+p;i.setAttribute(a,d)}else{let d;Array.isArray(c)?go(c,n):c instanceof Element?(d=c,i.replaceWith(d)):i.nodeValue=dt(c),d&&(n.targetNode=d)}}}function bo(t){let e="",n=!1,i=!1,r=-1;const o=new Map,a=[];let l=0;for(let c=0,d=t.length;c<d;c++){const y=t[c];if(e+=y.slice(l),c===d-1)break;for(let m=0;m<y.length;m++)switch(y.charAt(m)){case"<":{y.charAt(m+1)==="/"?a.pop():(n=!0,a.push(++r));break}case">":{n=!1,i=!1;break}case"=":{i=!0;break}}const f=a[a.length-1],b=ve(o,f,()=>[]);let j,C,A;if(i){const m=/(\S+)="?([^"=]*)$/.exec(y);j=m[1],C=m[2];const k=/^([^">]*)("?)/.exec(t[c+1]);A=k[1],e=e.slice(0,-1*m[0].length),l=k[0].length}else l=0;const z={attributeName:j,attributeValuePre:C,attributeValuePost:A,expressionIndex:c};b.push(z),!n&&!i&&(e+=" ")}return{template:co(e),elementsToBindings:o}}function ft(t,e,n){for(let i=0;i<t.length;i++){const r=t[i],o=r.attributeName?e:e.firstChild,a={binding:r,targetNode:o,targetParentNode:void 0,currentExpression:void 0};n.push(a)}}function vo(t,e){const n=[];let i;if(e.size===1&&(i=e.get(0)))ft(i,t,n);else{const r=document.createTreeWalker(t,NodeFilter.SHOW_ELEMENT);let o=t,a=-1;do{const l=e.get(++a);l&&ft(l,o,n)}while(o=r.nextNode())}return n}function ko(t){const{template:e,elementsToBindings:n}=ve(lo,t,()=>bo(t)),i=e.cloneNode(!0).content.firstElementChild,r=vo(i,n);return function(a){return yo(a,r),i}}function Eo(t){const e=ve(uo,t,()=>new Map);let n=fo;function i(o,...a){const l=ve(e,o,()=>new Map);return ve(l,n,()=>ko(o))(a)}function r(o,a,l){return o.map((p,c)=>{const d=n;n=l(p);try{return a(p,c)}finally{n=d}})}return{map:r,html:i}}function wo(t,e,n,i,r,o,a,l,p){const{labelWithSkin:c,titleForEmoji:d,unicodeWithSkin:y}=n,{html:f,map:b}=Eo(e);function j(m,k,I){return b(m,($,q)=>f`<button role="${k?"option":"menuitem"}" aria-selected="${k?q===e.activeSearchItem:null}" aria-label="${c($,e.currentSkinTone)}" title="${d($)}" class="${"emoji"+(k&&q===e.activeSearchItem?" active":"")+($.unicode?"":" custom-emoji")}" id="${`${I}-${$.id}`}" style="${$.unicode?null:`--custom-emoji-background: url(${JSON.stringify($.url)})`}">${$.unicode?y($,e.currentSkinTone):""}</button>`,$=>`${I}-${$.id}`)}const A=f`<section data-ref="rootElement" class="picker" aria-label="${e.i18n.regionLabel}" style="${e.pickerStyle||""}"><div class="pad-top"></div><div class="search-row"><div class="search-wrapper"><input id="search" class="search" type="search" role="combobox" enterkeyhint="search" placeholder="${e.i18n.searchLabel}" autocapitalize="none" autocomplete="off" spellcheck="true" aria-expanded="${!!(e.searchMode&&e.currentEmojis.length)}" aria-controls="search-results" aria-describedby="search-description" aria-autocomplete="list" aria-activedescendant="${e.activeSearchItemId?`emo-${e.activeSearchItemId}`:null}" data-ref="searchElement" data-on-input="onSearchInput" data-on-keydown="onSearchKeydown"><label class="sr-only" for="search">${e.i18n.searchLabel}</label> <span id="search-description" class="sr-only">${e.i18n.searchDescription}</span></div><div class="skintone-button-wrapper ${e.skinTonePickerExpandedAfterAnimation?"expanded":""}"><button id="skintone-button" class="emoji ${e.skinTonePickerExpanded?"hide-focus":""}" aria-label="${e.skinToneButtonLabel}" title="${e.skinToneButtonLabel}" aria-describedby="skintone-description" aria-haspopup="listbox" aria-expanded="${e.skinTonePickerExpanded}" aria-controls="skintone-list" data-on-click="onClickSkinToneButton">${e.skinToneButtonText||""}</button></div><span id="skintone-description" class="sr-only">${e.i18n.skinToneDescription}</span><div data-ref="skinToneDropdown" id="skintone-list" class="skintone-list hide-focus ${e.skinTonePickerExpanded?"":"hidden no-animate"}" style="transform:translateY(${e.skinTonePickerExpanded?0:"calc(-1 * var(--num-skintones) * var(--total-emoji-size))"})" role="listbox" aria-label="${e.i18n.skinTonesLabel}" aria-activedescendant="skintone-${e.activeSkinTone}" aria-hidden="${!e.skinTonePickerExpanded}" tabIndex="-1" data-on-focusout="onSkinToneOptionsFocusOut" data-on-click="onSkinToneOptionsClick" data-on-keydown="onSkinToneOptionsKeydown" data-on-keyup="onSkinToneOptionsKeyup">${b(e.skinTones,(m,k)=>f`<div id="skintone-${k}" class="emoji ${k===e.activeSkinTone?"active":""}" aria-selected="${k===e.activeSkinTone}" role="option" title="${e.i18n.skinTones[k]}" aria-label="${e.i18n.skinTones[k]}">${m}</div>`,m=>m)}</div></div><div class="nav" role="tablist" style="grid-template-columns:repeat(${e.groups.length},1fr)" aria-label="${e.i18n.categoriesLabel}" data-on-keydown="onNavKeydown" data-on-click="onNavClick">${b(e.groups,m=>f`<button role="tab" class="nav-button" aria-controls="tab-${m.id}" aria-label="${e.i18n.categories[m.name]}" aria-selected="${!e.searchMode&&e.currentGroup.id===m.id}" title="${e.i18n.categories[m.name]}" data-group-id="${m.id}"><div class="nav-emoji emoji">${m.emoji}</div></button>`,m=>m.id)}</div><div class="indicator-wrapper"><div class="indicator" style="transform:translateX(${(e.isRtl?-1:1)*e.currentGroupIndex*100}%)"></div></div><div class="message ${e.message?"":"gone"}" role="alert" aria-live="polite">${e.message||""}</div><div data-ref="tabpanelElement" class="tabpanel ${!e.databaseLoaded||e.message?"gone":""}" role="${e.searchMode?"region":"tabpanel"}" aria-label="${e.searchMode?e.i18n.searchResultsLabel:e.i18n.categories[e.currentGroup.name]}" id="${e.searchMode?null:`tab-${e.currentGroup.id}`}" tabIndex="0" data-on-click="onEmojiClick"><div data-action="calculateEmojiGridStyle">${b(e.currentEmojisWithCategories,(m,k)=>f`<div><div id="menu-label-${k}" class="category ${e.currentEmojisWithCategories.length===1&&e.currentEmojisWithCategories[0].category===""?"gone":""}" aria-hidden="true">${e.searchMode?e.i18n.searchResultsLabel:m.category?m.category:e.currentEmojisWithCategories.length>1?e.i18n.categories.custom:e.i18n.categories[e.currentGroup.name]}</div><div class="emoji-menu ${k!==0&&!e.searchMode&&e.currentGroup.id===-1?"visibility-auto":""}" style="${`--num-rows: ${Math.ceil(m.emojis.length/e.numColumns)}`}" data-action="updateOnIntersection" role="${e.searchMode?"listbox":"menu"}" aria-labelledby="menu-label-${k}" id="${e.searchMode?"search-results":null}">${j(m.emojis,e.searchMode,"emo")}</div></div>`,m=>m.category)}</div></div><div class="favorites onscreen emoji-menu ${e.message?"gone":""}" role="menu" aria-label="${e.i18n.favoritesLabel}" data-on-click="onEmojiClick">${j(e.currentFavorites,!1,"fav")}</div><button data-ref="baselineEmoji" aria-hidden="true" tabindex="-1" class="abs-pos hidden emoji baseline-emoji">üòÄ</button></section>`,z=(m,k)=>{for(const I of t.querySelectorAll(`[${m}]`))k(I,I.getAttribute(m))};if(p){t.appendChild(A);for(const m of["click","focusout","input","keydown","keyup"])z(`data-on-${m}`,(k,I)=>{k.addEventListener(m,i[I])});z("data-ref",(m,k)=>{o[k]=m}),a.addEventListener("abort",()=>{t.removeChild(A)})}z("data-action",(m,k)=>{let I=l.get(k);I||l.set(k,I=new WeakSet),I.has(m)||(I.add(m),r[k](m))})}const Ae=typeof queueMicrotask=="function"?queueMicrotask:t=>Promise.resolve().then(t);function _o(t){let e=!1,n;const i=new Map,r=new Set;let o;const a=()=>{if(e)return;const c=[...r];r.clear();try{for(const d of c)d()}finally{o=!1,r.size&&(o=!0,Ae(a))}},l=new Proxy({},{get(c,d){if(n){let y=i.get(d);y||(y=new Set,i.set(d,y)),y.add(n)}return c[d]},set(c,d,y){if(c[d]!==y){c[d]=y;const f=i.get(d);if(f){for(const b of f)r.add(b);o||(o=!0,Ae(a))}}return!0}}),p=c=>{const d=()=>{const y=n;n=d;try{return c()}finally{n=y}};return d()};return t.addEventListener("abort",()=>{e=!0}),{state:l,createEffect:p}}function Ke(t,e,n){if(t.length!==e.length)return!1;for(let i=0;i<t.length;i++)if(!n(t[i],e[i]))return!1;return!0}const mt=new WeakMap;function To(t,e,n){{const i=t.closest(".tabpanel");let r=mt.get(i);r||(r=new IntersectionObserver(n,{root:i,rootMargin:"50% 0px 50% 0px",threshold:0}),mt.set(i,r),e.addEventListener("abort",()=>{r.disconnect()})),r.observe(t)}}const Ge=[],{assign:je}=Object;function jo(t,e){const n={},i=new AbortController,r=i.signal,{state:o,createEffect:a}=_o(r),l=new Map;je(o,{skinToneEmoji:void 0,i18n:void 0,database:void 0,customEmoji:void 0,customCategorySorting:void 0,emojiVersion:void 0}),je(o,e),je(o,{initialLoad:!0,currentEmojis:[],currentEmojisWithCategories:[],rawSearchText:"",searchText:"",searchMode:!1,activeSearchItem:-1,message:void 0,skinTonePickerExpanded:!1,skinTonePickerExpandedAfterAnimation:!1,currentSkinTone:0,activeSkinTone:0,skinToneButtonText:void 0,pickerStyle:void 0,skinToneButtonLabel:"",skinTones:[],currentFavorites:[],defaultFavoriteEmojis:void 0,numColumns:Gn,isRtl:!1,currentGroupIndex:0,groups:Re,databaseLoaded:!1,activeSearchItemId:void 0}),a(()=>{o.currentGroup!==o.groups[o.currentGroupIndex]&&(o.currentGroup=o.groups[o.currentGroupIndex])});const p=s=>{t.getElementById(s).focus()},c=s=>t.getElementById(`emo-${s.id}`),d=(s,u)=>{n.rootElement.dispatchEvent(new CustomEvent(s,{detail:u,bubbles:!0,composed:!0}))},y=(s,u)=>s.id===u.id,f=(s,u)=>{const{category:v,emojis:w}=s,{category:P,emojis:R}=u;return v!==P?!1:Ke(w,R,y)},b=s=>{Ke(o.currentEmojis,s,y)||(o.currentEmojis=s)},j=s=>{o.searchMode!==s&&(o.searchMode=s)},C=s=>{Ke(o.currentEmojisWithCategories,s,f)||(o.currentEmojisWithCategories=s)},A=(s,u)=>u&&s.skins&&s.skins[u]||s.unicode,k={labelWithSkin:(s,u)=>so([s.name||A(s,u),s.annotation,...s.shortcodes||Ge].filter(Boolean)).join(", "),titleForEmoji:s=>s.annotation||(s.shortcodes||Ge).join(", "),unicodeWithSkin:A},I={onClickSkinToneButton:ke,onEmojiClick:S,onNavClick:h,onNavKeydown:_,onSearchKeydown:g,onSkinToneOptionsClick:Oe,onSkinToneOptionsFocusOut:ce,onSkinToneOptionsKeydown:ne,onSkinToneOptionsKeyup:Ee,onSearchInput:Pe},$={calculateEmojiGridStyle:re,updateOnIntersection:O};let q=!0;a(()=>{wo(t,o,k,I,$,n,r,l,q),q=!1}),o.emojiVersion||ze().then(s=>{s||(o.message=o.i18n.emojiUnsupportedMessage)}),a(()=>{async function s(){let u=!1;const v=setTimeout(()=>{u=!0,o.message=o.i18n.loadingMessage},Un);try{await o.database.ready(),o.databaseLoaded=!0}catch(w){console.error(w),o.message=o.i18n.networkErrorMessage}finally{clearTimeout(v),u&&(u=!1,o.message="")}}o.database&&s()}),a(()=>{o.pickerStyle=`
      --num-groups: ${o.groups.length}; 
      --indicator-opacity: ${o.searchMode?0:1}; 
      --num-skintones: ${at};`}),a(()=>{o.customEmoji&&o.database&&ee()}),a(()=>{o.customEmoji&&o.customEmoji.length?o.groups!==Xe&&(o.groups=Xe):o.groups!==Re&&(o.currentGroupIndex&&o.currentGroupIndex--,o.groups=Re)}),a(()=>{async function s(){o.databaseLoaded&&(o.currentSkinTone=await o.database.getPreferredSkinTone())}s()}),a(()=>{o.skinTones=Array(at).fill().map((s,u)=>to(o.skinToneEmoji,u))}),a(()=>{o.skinToneButtonText=o.skinTones[o.currentSkinTone]}),a(()=>{o.skinToneButtonLabel=o.i18n.skinToneLabel.replace("{skinTone}",o.i18n.skinTones[o.currentSkinTone])}),a(()=>{async function s(){const{database:u}=o,v=(await Promise.all(Vn.map(w=>u.getEmojiByUnicodeOrName(w)))).filter(Boolean);o.defaultFavoriteEmojis=v}o.databaseLoaded&&s()});function ee(){const{customEmoji:s,database:u}=o,v=s||Ge;u.customEmoji!==v&&(u.customEmoji=v)}a(()=>{async function s(){ee();const{database:u,defaultFavoriteEmojis:v,numColumns:w}=o,P=await u.getTopFavoriteEmoji(w),R=await L(Gt([...P,...v],Y=>Y.unicode||Y.name).slice(0,w));o.currentFavorites=R}o.databaseLoaded&&o.defaultFavoriteEmojis&&s()});function re(s){io(s,r,()=>{{const u=getComputedStyle(n.rootElement),v=parseInt(u.getPropertyValue("--num-columns"),10),w=u.getPropertyValue("direction")==="rtl";o.numColumns=v,o.isRtl=w}})}function O(s){To(s,r,u=>{for(const{target:v,isIntersecting:w}of u)v.classList.toggle("onscreen",w)})}a(()=>{async function s(){const{searchText:u,currentGroup:v,databaseLoaded:w,customEmoji:P}=o;if(!w)o.currentEmojis=[],o.searchMode=!1;else if(u.length>=zn){const R=await H(u);o.searchText===u&&(b(R),j(!0))}else{const{id:R}=v;if(R!==-1||P&&P.length){const Y=await N(R);o.currentGroup.id===R&&(b(Y),j(!1))}}}s()});const te=()=>{xe(()=>ao(n.tabpanelElement))};a(()=>{const{currentEmojis:s,emojiVersion:u}=o,v=s.filter(w=>w.unicode).filter(w=>ct(w)&&!Ze.has(w.unicode));if(!u&&v.length)b(s),xe(()=>W(v));else{const w=u?s:s.filter(E);b(w),te()}});function W(s){ro(s,n.baselineEmoji,c)?te():o.currentEmojis=[...o.currentEmojis]}function E(s){return!s.unicode||!ct(s)||Ze.get(s.unicode)}async function T(s){const u=o.emojiVersion||await ze();return s.filter(({version:v})=>!v||v<=u)}async function L(s){return no(s,o.emojiVersion||await ze())}async function N(s){const u=s===-1?o.customEmoji:await o.database.getEmojiByGroup(s);return L(await T(u))}async function H(s){return L(await T(await o.database.getEmojiBySearchQuery(s)))}a(()=>{}),a(()=>{function s(){const{searchMode:v,currentEmojis:w}=o;if(v)return[{category:"",emojis:w}];const P=new Map;for(const R of w){const Y=R.category||"";let we=P.get(Y);we||(we=[],P.set(Y,we)),we.push(R)}return[...P.entries()].map(([R,Y])=>({category:R,emojis:Y})).sort((R,Y)=>o.customCategorySorting(R.category,Y.category))}const u=s();C(u)}),a(()=>{o.activeSearchItemId=o.activeSearchItem!==-1&&o.currentEmojis[o.activeSearchItem].id}),a(()=>{const{rawSearchText:s}=o;Ut(()=>{o.searchText=(s||"").trim(),o.activeSearchItem=-1})});function g(s){if(!o.searchMode||!o.currentEmojis.length)return;const u=v=>{X(s),o.activeSearchItem=Ne(v,o.activeSearchItem,o.currentEmojis)};switch(s.key){case"ArrowDown":return u(!1);case"ArrowUp":return u(!0);case"Enter":if(o.activeSearchItem===-1)o.activeSearchItem=0;else return X(s),M(o.currentEmojis[o.activeSearchItem].id)}}function h(s){const{target:u}=s,v=u.closest(".nav-button");if(!v)return;const w=parseInt(v.dataset.groupId,10);n.searchElement.value="",o.rawSearchText="",o.searchText="",o.activeSearchItem=-1,o.currentGroupIndex=o.groups.findIndex(P=>P.id===w)}function _(s){const{target:u,key:v}=s,w=P=>{P&&(X(s),P.focus())};switch(v){case"ArrowLeft":return w(u.previousElementSibling);case"ArrowRight":return w(u.nextElementSibling);case"Home":return w(u.parentElement.firstElementChild);case"End":return w(u.parentElement.lastElementChild)}}async function M(s){const u=await o.database.getEmojiByUnicodeOrName(s),v=[...o.currentEmojis,...o.currentFavorites].find(P=>P.id===s),w=v.unicode&&A(v,o.currentSkinTone);await o.database.incrementFavoriteEmojiCount(s),d("emoji-click",{emoji:u,skinTone:o.currentSkinTone,...w&&{unicode:w},...v.name&&{name:v.name}})}async function S(s){const{target:u}=s;if(!u.classList.contains("emoji"))return;X(s);const v=u.id.substring(4);M(v)}function F(s){o.currentSkinTone=s,o.skinTonePickerExpanded=!1,p("skintone-button"),d("skin-tone-change",{skinTone:s}),o.database.setPreferredSkinTone(s)}function Oe(s){const{target:{id:u}}=s,v=u&&u.match(/^skintone-(\d)/);if(!v)return;X(s);const w=parseInt(v[1],10);F(w)}function ke(s){o.skinTonePickerExpanded=!o.skinTonePickerExpanded,o.activeSkinTone=o.currentSkinTone,o.skinTonePickerExpanded&&(X(s),xe(()=>p("skintone-list")))}a(()=>{o.skinTonePickerExpanded?n.skinToneDropdown.addEventListener("transitionend",()=>{o.skinTonePickerExpandedAfterAnimation=!0},{once:!0}):o.skinTonePickerExpandedAfterAnimation=!1});function ne(s){if(!o.skinTonePickerExpanded)return;const u=async v=>{X(s),o.activeSkinTone=v};switch(s.key){case"ArrowUp":return u(Ne(!0,o.activeSkinTone,o.skinTones));case"ArrowDown":return u(Ne(!1,o.activeSkinTone,o.skinTones));case"Home":return u(0);case"End":return u(o.skinTones.length-1);case"Enter":return X(s),F(o.activeSkinTone);case"Escape":return X(s),o.skinTonePickerExpanded=!1,p("skintone-button")}}function Ee(s){if(o.skinTonePickerExpanded)switch(s.key){case" ":return X(s),F(o.activeSkinTone)}}async function ce(s){const{relatedTarget:u}=s;(!u||u.id!=="skintone-list")&&(o.skinTonePickerExpanded=!1)}function Pe(s){o.rawSearchText=s.target.value}return{$set(s){je(o,s)},$destroy(){i.abort()}}}const So="https://cdn.jsdelivr.net/npm/emoji-picker-element-data@^1/en/emojibase/data.json",xo="en";var Co={categoriesLabel:"Categories",emojiUnsupportedMessage:"Your browser does not support color emoji.",favoritesLabel:"Favorites",loadingMessage:"Loading‚Ä¶",networkErrorMessage:"Could not load emoji.",regionLabel:"Emoji picker",searchDescription:"When search results are available, press up or down to select and enter to choose.",searchLabel:"Search",searchResultsLabel:"Search results",skinToneDescription:"When expanded, press up or down to select and enter to choose.",skinToneLabel:"Choose a skin tone (currently {skinTone})",skinTonesLabel:"Skin tones",skinTones:["Default","Light","Medium-Light","Medium","Medium-Dark","Dark"],categories:{custom:"Custom","smileys-emotion":"Smileys and emoticons","people-body":"People and body","animals-nature":"Animals and nature","food-drink":"Food and drink","travel-places":"Travel and places",activities:"Activities",objects:"Objects",symbols:"Symbols",flags:"Flags"}},Io=':host{--emoji-size:1.375rem;--emoji-padding:0.5rem;--category-emoji-size:var(--emoji-size);--category-emoji-padding:var(--emoji-padding);--indicator-height:3px;--input-border-radius:0.5rem;--input-border-size:1px;--input-font-size:1rem;--input-line-height:1.5;--input-padding:0.25rem;--num-columns:8;--outline-size:2px;--border-size:1px;--border-radius:0;--skintone-border-radius:1rem;--category-font-size:1rem;display:flex;width:min-content;height:400px}:host,:host(.light){color-scheme:light;--background:#fff;--border-color:#e0e0e0;--indicator-color:#385ac1;--input-border-color:#999;--input-font-color:#111;--input-placeholder-color:#999;--outline-color:#999;--category-font-color:#111;--button-active-background:#e6e6e6;--button-hover-background:#d9d9d9}:host(.dark){color-scheme:dark;--background:#222;--border-color:#444;--indicator-color:#5373ec;--input-border-color:#ccc;--input-font-color:#efefef;--input-placeholder-color:#ccc;--outline-color:#fff;--category-font-color:#efefef;--button-active-background:#555555;--button-hover-background:#484848}@media (prefers-color-scheme:dark){:host{color-scheme:dark;--background:#222;--border-color:#444;--indicator-color:#5373ec;--input-border-color:#ccc;--input-font-color:#efefef;--input-placeholder-color:#ccc;--outline-color:#fff;--category-font-color:#efefef;--button-active-background:#555555;--button-hover-background:#484848}}:host([hidden]){display:none}button{margin:0;padding:0;border:0;background:0 0;box-shadow:none;-webkit-tap-highlight-color:transparent}button::-moz-focus-inner{border:0}input{padding:0;margin:0;line-height:1.15;font-family:inherit}input[type=search]{-webkit-appearance:none}:focus{outline:var(--outline-color) solid var(--outline-size);outline-offset:calc(-1*var(--outline-size))}:host([data-js-focus-visible]) :focus:not([data-focus-visible-added]){outline:0}:focus:not(:focus-visible){outline:0}.hide-focus{outline:0}*{box-sizing:border-box}.picker{contain:content;display:flex;flex-direction:column;background:var(--background);border:var(--border-size) solid var(--border-color);border-radius:var(--border-radius);width:100%;height:100%;overflow:hidden;--total-emoji-size:calc(var(--emoji-size) + (2 * var(--emoji-padding)));--total-category-emoji-size:calc(var(--category-emoji-size) + (2 * var(--category-emoji-padding)))}.sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);border:0}.hidden{opacity:0;pointer-events:none}.abs-pos{position:absolute;left:0;top:0}.gone{display:none!important}.skintone-button-wrapper,.skintone-list{background:var(--background);z-index:3}.skintone-button-wrapper.expanded{z-index:1}.skintone-list{position:absolute;inset-inline-end:0;top:0;z-index:2;overflow:visible;border-bottom:var(--border-size) solid var(--border-color);border-radius:0 0 var(--skintone-border-radius) var(--skintone-border-radius);will-change:transform;transition:transform .2s ease-in-out;transform-origin:center 0}@media (prefers-reduced-motion:reduce){.skintone-list{transition-duration:.001s}}@supports not (inset-inline-end:0){.skintone-list{right:0}}.skintone-list.no-animate{transition:none}.tabpanel{overflow-y:auto;scrollbar-gutter:stable;-webkit-overflow-scrolling:touch;will-change:transform;min-height:0;flex:1;contain:content}.emoji-menu{display:grid;grid-template-columns:repeat(var(--num-columns),var(--total-emoji-size));justify-content:space-around;align-items:flex-start;width:100%}.emoji-menu.visibility-auto{content-visibility:auto;contain-intrinsic-size:calc(var(--num-columns)*var(--total-emoji-size)) calc(var(--num-rows)*var(--total-emoji-size))}.category{padding:var(--emoji-padding);font-size:var(--category-font-size);color:var(--category-font-color)}.emoji,button.emoji{font-size:var(--emoji-size);display:flex;align-items:center;justify-content:center;border-radius:100%;height:var(--total-emoji-size);width:var(--total-emoji-size);line-height:1;overflow:hidden;font-family:var(--emoji-font-family);cursor:pointer}@media (hover:hover) and (pointer:fine){.emoji:hover,button.emoji:hover{background:var(--button-hover-background)}}.emoji.active,.emoji:active,button.emoji.active,button.emoji:active{background:var(--button-active-background)}.onscreen .custom-emoji::after{content:"";width:var(--emoji-size);height:var(--emoji-size);background-repeat:no-repeat;background-position:center center;background-size:contain;background-image:var(--custom-emoji-background)}.nav,.nav-button{align-items:center}.nav{display:grid;justify-content:space-between;contain:content}.nav-button{display:flex;justify-content:center}.nav-emoji{font-size:var(--category-emoji-size);width:var(--total-category-emoji-size);height:var(--total-category-emoji-size)}.indicator-wrapper{display:flex;border-bottom:1px solid var(--border-color)}.indicator{width:calc(100%/var(--num-groups));height:var(--indicator-height);opacity:var(--indicator-opacity);background-color:var(--indicator-color);will-change:transform,opacity;transition:opacity .1s linear,transform .25s ease-in-out}@media (prefers-reduced-motion:reduce){.indicator{will-change:opacity;transition:opacity .1s linear}}.pad-top,input.search{background:var(--background);width:100%}.pad-top{height:var(--emoji-padding);z-index:3}.search-row{display:flex;align-items:center;position:relative;padding-inline-start:var(--emoji-padding);padding-bottom:var(--emoji-padding)}.search-wrapper{flex:1;min-width:0}input.search{padding:var(--input-padding);border-radius:var(--input-border-radius);border:var(--input-border-size) solid var(--input-border-color);color:var(--input-font-color);font-size:var(--input-font-size);line-height:var(--input-line-height)}input.search::placeholder{color:var(--input-placeholder-color)}.favorites{overflow-y:auto;scrollbar-gutter:stable;display:flex;flex-direction:row;border-top:var(--border-size) solid var(--border-color);contain:content}.message{padding:var(--emoji-padding)}';const Vt=["customEmoji","customCategorySorting","database","dataSource","i18n","locale","skinToneEmoji","emojiVersion"],Do=`:host{--emoji-font-family:${Kt}}`;class Wt extends HTMLElement{constructor(e){super(),this.attachShadow({mode:"open"});const n=document.createElement("style");n.textContent=Io+Do,this.shadowRoot.appendChild(n),this._ctx={locale:xo,dataSource:So,skinToneEmoji:Kn,customCategorySorting:Wn,customEmoji:null,i18n:Co,emojiVersion:null,...e};for(const i of Vt)i!=="database"&&Object.prototype.hasOwnProperty.call(this,i)&&(this._ctx[i]=this[i],delete this[i]);this._dbFlush()}connectedCallback(){this._cmp||(this._cmp=jo(this.shadowRoot,this._ctx))}disconnectedCallback(){Ae(()=>{if(!this.isConnected&&this._cmp){this._cmp.$destroy(),this._cmp=void 0;const{database:e}=this._ctx;e.close().catch(n=>console.error(n))}})}static get observedAttributes(){return["locale","data-source","skin-tone-emoji","emoji-version"]}attributeChangedCallback(e,n,i){this._set(e.replace(/-([a-z])/g,(r,o)=>o.toUpperCase()),e==="emoji-version"?parseFloat(i):i)}_set(e,n){this._ctx[e]=n,this._cmp&&this._cmp.$set({[e]:n}),["locale","dataSource"].includes(e)&&this._dbFlush()}_dbCreate(){const{locale:e,dataSource:n,database:i}=this._ctx;(!i||i.locale!==e||i.dataSource!==n)&&this._set("database",new Fn({locale:e,dataSource:n}))}_dbFlush(){Ae(()=>this._dbCreate())}}const Ht={};for(const t of Vt)Ht[t]={get(){return t==="database"&&this._dbCreate(),this._ctx[t]},set(e){if(t==="database")throw new Error("database is read-only");this._set(t,e)}};Object.defineProperties(Wt.prototype,Ht);customElements.get("emoji-picker")||customElements.define("emoji-picker",Wt);const $o={class:"chat-header d-flex align-center"},Lo={class:"font-weight-bold text-subtitle-1"},Mo={key:0,class:"text-caption grey--text"},Ao={class:"date-divider"},Oo={class:"message"},Po={class:"message-content"},Bo={class:"message-meta"},Ro={class:"chat-input-modern"},Fo=["placeholder","onKeydown"],zo="https://cdn-icons-png.flaticon.com/512/149/149071.png",No={__name:"ChatViewDesktop",setup(t){const e=yt(),n=ht(),{t:i,locale:r}=gt(),o=e.params.chatId,a=n.id,l=K(""),p=K([]),c=K(null),d=K({nickname:"",profile_photo:""}),y=se(()=>{var g;return((g=d.value)==null?void 0:g.id)||null}),f=K(!1),b=K(!1),j=se(()=>window.innerWidth<=600);let C=null;function A(){b.value=!b.value}function z(g){l.value+=g.detail.unicode}function m(g){const h=document.querySelector(".emoji-picker"),_=document.querySelector(".mdi-emoticon-outline");h&&!h.contains(g.target)&&(!_||!_.contains(g.target))&&(b.value=!1)}function k(){Ve(()=>{c.value&&(c.value.scrollTop=c.value.scrollHeight)})}function I(){re(),clearTimeout(C),C=setTimeout(()=>{O()},1500)}function $(g){const h=new Date,_=new Date;_.setDate(h.getDate()-1);const M=(S,F)=>S.getDate()===F.getDate()&&S.getMonth()===F.getMonth()&&S.getFullYear()===F.getFullYear();return M(g,h)?i("chats.hoy"):M(g,_)?i("chats.ayer"):g.toLocaleDateString(r.value,{day:"numeric",month:"long",year:"numeric"})}const q=se(()=>{var _;const g=[],h={};for(const M of p.value){if(!((_=M.timestamp)!=null&&_.toDate))continue;const S=M.timestamp.toDate(),F=$(S);h[F]||(h[F]={label:F,messages:[]},g.push(h[F])),h[F].messages.push(M)}return g});async function ee(){if(!l.value.trim())return;const g=jt(Q,`chats/${o}/messages`);await St(g,{sender_id:a,text:l.value.trim(),timestamp:$e(),status:"sent"});const h=ae(Q,"chats",o);await me(h,{last_message:l.value.trim(),updated_at:$e(),[`typing_${a}`]:!1}),l.value="",k()}function re(){const g=ae(Q,"chats",o);me(g,{[`typing_${a}`]:!0})}function O(){const g=ae(Q,"chats",o);me(g,{[`typing_${a}`]:!1})}async function te(){const g=ae(Q,"chats",o);Tt(g,async h=>{const _=h.data(),M=_.buyer_id===a?_.seller_id:_.buyer_id,S=await n.fetchUserById(M);d.value=S,f.value=_[`typing_${M}`]===!0})}const W=se(()=>{var g;for(let h=p.value.length-1;h>=0;h--){const _=p.value[h];if(_.sender_id===a&&((g=_.read_by)!=null&&g.includes(y.value)))return console.log("Mensaje le√≠do por receptor:",_.text,h),h}return-1});function E(g){return console.log("index:",g,"lastReadIndex:",W.value),g===W.value}function T(g){return!g||!g.toDate?"":g.toDate().toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}function L(){var _,M;const g=document.documentElement.getAttribute("data-theme"),h=document.querySelector("emoji-picker");if(h)if(g==="light"){h.style.setProperty("--background","#ffffff"),h.style.setProperty("--color","#1e1e1e"),h.style.setProperty("--border-color","#ddd"),h.style.setProperty("--category-button-color","#333"),h.style.setProperty("--category-button-active-color","#2c3e50"),h.style.setProperty("--indicator-color","#2c3e50"),h.style.setProperty("--search-input-background","#f8f8f8"),h.style.setProperty("--search-input-color","#1e1e1e");const S=(_=h.shadowRoot)==null?void 0:_.querySelector("input");S&&(S.style.color="#1e1e1e",S.style.backgroundColor="#ffffff",S.style.caretColor="#1e1e1e")}else{h.style.setProperty("--background","#1e1e1e"),h.style.setProperty("--color","#f0f0f0"),h.style.setProperty("--border-color","#444"),h.style.setProperty("--category-button-color","#f0f0f0"),h.style.setProperty("--category-button-active-color","#ffffff"),h.style.setProperty("--indicator-color","#f0f0f0"),h.style.setProperty("--search-input-background","#2c2c2c"),h.style.setProperty("--search-input-color","#ffffff");const S=(M=h.shadowRoot)==null?void 0:M.querySelector("input");S&&(S.style.color="#ffffff",S.style.backgroundColor="#2c2c2c",S.style.caretColor="#ffffff")}}qt(()=>{b.value&&Ve(()=>{setTimeout(L,50)})});const N=K("");function H(){const g=document.documentElement.getAttribute("data-theme")||"light";N.value=g==="dark"?"https://raw.githubusercontent.com/BookCaseUa/bookcase/main/wallapaper-dark.png":"https://raw.githubusercontent.com/BookCaseUa/bookcase/main/wallapaper.png"}return H(),Je(()=>{function g(){let _=window.innerHeight*.01;document.documentElement.style.setProperty("--vh",`${_}px`)}g(),window.addEventListener("resize",g),bt(o,async _=>{p.value=_.docs.map(M=>M.data()),await xt(o,n.id),k()}),te(),document.addEventListener("click",m);const h=new MutationObserver(H);h.observe(document.documentElement,{attributes:!0,attributeFilter:["data-theme"]}),We(()=>{h.disconnect()})}),We(()=>{document.removeEventListener("click",m)}),(g,h)=>{const _=Z("v-img"),M=Z("v-avatar"),S=Z("v-icon"),F=Z("emoji-picker"),Oe=Z("v-container");return B(),G(le,null,[h[4]||(h[4]=D("div",{class:"header-skip"},null,-1)),U(Oe,{class:"chat-container",style:_t({backgroundImage:`url(${N.value})`})},{default:V(()=>{var ke;return[D("div",$o,[U(M,{size:"48",class:"mr-3"},{default:V(()=>{var ne;return[U(_,{src:((ne=d.value.data)==null?void 0:ne.profile_photo)||zo},null,8,["src"])]}),_:1}),D("div",null,[D("div",Lo,oe(((ke=d.value.data)==null?void 0:ke.nickname)||g.$t("chats.usuario")),1),f.value?(B(),G("div",Mo,"Escribiendo")):fe("",!0)])]),D("div",{class:"chat-messages",ref_key:"chatBox",ref:c},[U(Yt,{name:"fade",tag:"div"},{default:V(()=>[(B(!0),G(le,null,Ce(q.value,(ne,Ee)=>(B(),G(le,{key:Ee},[D("div",Ao,oe(ne.label),1),(B(!0),G(le,null,Ce(ne.messages,(ce,Pe)=>(B(),G("div",{key:`${Ee}-${Pe}`,class:be(["message-row",ce.sender_id===x(a)?"sent":"received"])},[D("div",Oo,[D("div",Po,[J(oe(ce.text)+" ",1),D("span",Bo,[J(oe(T(ce.timestamp))+" ",1),ce.sender_id===x(a)?(B(),Ie(S,{key:0,size:"16",class:be(["status-icon",E(p.value.indexOf(ce))?"check-leido":"check-no-leido"])},{default:V(()=>h[1]||(h[1]=[J(" mdi-check-all ")])),_:2},1032,["class"])):fe("",!0)])])])],2))),128))],64))),128))]),_:1})],512),D("div",Ro,[U(S,{class:"emoji-icon",onClick:De(A,["stop"])},{default:V(()=>h[2]||(h[2]=[J(" mdi-emoticon-outline ")])),_:1}),vt(D("input",{"onUpdate:modelValue":h[0]||(h[0]=ne=>l.value=ne),placeholder:g.$t("chats.escribirMensaje"),class:"message-input",onKeydown:[I,Et(De(ee,["prevent"]),["enter"])]},null,40,Fo),[[kt,l.value]]),U(S,{class:"send-icon",onClick:ee},{default:V(()=>h[3]||(h[3]=[J(" mdi-send ")])),_:1})]),U(wt,{name:"fade"},{default:V(()=>[b.value?(B(),G("div",{key:0,class:be(["emoji-picker",{"emoji-picker-mobile":j.value}])},[U(F,{onEmojiClick:z})],2)):fe("",!0)]),_:1})]}),_:1},8,["style"])],64)}}},Uo=pt(No,[["__scopeId","data-v-0aed828b"]]);function Ko(){const t=yt(),e=ht(),{t:n,locale:i}=gt(),r=t.params.chatId,o=se(()=>e.id),a=K(""),l=K([]),p=K(null),c=K({}),d=K(!1),y=K(!1),f="https://cdn-icons-png.flaticon.com/512/149/149071.png",b=se(()=>{var E;return((E=c.value)==null?void 0:E.id)||null});let j=null;function C(){Ve(()=>{p.value&&(p.value.scrollTop=p.value.scrollHeight)})}function A(){z(),clearTimeout(j),j=setTimeout(()=>{m()},1500)}function z(){const E=ae(Q,"chats",r);me(E,{[`typing_${o.value}`]:!0})}function m(){const E=ae(Q,"chats",r);me(E,{[`typing_${o.value}`]:!1})}async function k(){if(!a.value.trim())return;const E=jt(Q,`chats/${r}/messages`);await St(E,{sender_id:o.value,text:a.value.trim(),timestamp:$e(),status:"sent"});const T=ae(Q,"chats",r);await me(T,{last_message:a.value.trim(),updated_at:$e(),[`typing_${o.value}`]:!1}),a.value="",C()}function I(E){const T=new Date,L=new Date;L.setDate(T.getDate()-1);const N=(H,g)=>H.getDate()===g.getDate()&&H.getMonth()===g.getMonth()&&H.getFullYear()===g.getFullYear();return N(E,T)?n("chats.hoy"):N(E,L)?n("chats.ayer"):E.toLocaleDateString(i.value,{day:"numeric",month:"long",year:"numeric"})}const $=se(()=>{var L;const E=[],T={};for(const N of l.value){if(!((L=N.timestamp)!=null&&L.toDate))continue;const H=N.timestamp.toDate(),g=I(H);T[g]||(T[g]={label:g,messages:[]},E.push(T[g])),T[g].messages.push(N)}return E}),q=se(()=>{var E;for(let T=l.value.length-1;T>=0;T--){const L=l.value[T];if(L.sender_id===o.value&&((E=L.read_by)!=null&&E.includes(b.value)))return T}return-1});function ee(E){return E===q.value}function re(E){return!E||!E.toDate?"":E.toDate().toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}function O(){y.value=!y.value}function te(E){a.value+=E.detail.unicode}async function W(){const E=ae(Q,"chats",r);Tt(E,async T=>{const L=T.data(),N=L.buyer_id===o.value?L.seller_id:L.buyer_id,H=await e.fetchUserById(N);c.value=H,d.value=L[`typing_${N}`]===!0})}return Je(()=>{bt(r,async E=>{l.value=E.docs.map(T=>T.data()),await xt(r,o.value),C()}),W()}),{newMessage:a,messages:l,otroUsuario:c,isTyping:d,showEmojiPicker:y,chatBox:p,defaultPhoto:f,groupedMessages:$,isLastRead:ee,formatHora:re,enviarMensaje:k,handleTyping:A,toggleEmojiPicker:O,addEmoji:te,currentUserId:o,receptorId:b}}const Go={class:"chat-mobile-header d-flex align-center"},Vo={class:"text-subtitle-2"},Wo={key:0,class:"text-caption text-grey"},Ho={class:"date-divider"},qo={class:"message"},Yo={class:"message-content"},Xo={class:"message-meta"},Zo={class:"chat-mobile-input-fixed"},Jo=["placeholder"],Qo={key:0,class:"emoji-picker emoji-picker-mobile"},ei={__name:"ChatViewMobile",setup(t){const{currentUserId:e,otroUsuario:n,defaultPhoto:i,isTyping:r,groupedMessages:o,messages:a,newMessage:l,showEmojiPicker:p,chatBox:c,backgroundImage:d,toggleEmojiPicker:y,addEmoji:f,handleTyping:b,enviarMensaje:j,isLastRead:C,formatHora:A}=Ko();return(z,m)=>{const k=Z("v-img"),I=Z("v-avatar"),$=Z("v-icon"),q=Z("emoji-picker"),ee=Z("v-container");return B(),Ie(ee,{class:"chat-mobile-container",style:_t({backgroundImage:`url(${x(d)})`})},{default:V(()=>{var re;return[D("div",Go,[U(I,{size:"40",class:"mr-2"},{default:V(()=>{var O;return[U(k,{src:((O=x(n).data)==null?void 0:O.profile_photo)||x(i)},null,8,["src"])]}),_:1}),D("div",null,[D("strong",Vo,oe(((re=x(n).data)==null?void 0:re.nickname)||z.$t("chats.usuario")),1),x(r)?(B(),G("div",Wo,oe(z.$t("chats.escribiendo")),1)):fe("",!0)])]),D("div",{class:"chat-mobile-messages",ref_key:"chatBox",ref:c},[(B(!0),G(le,null,Ce(x(o),(O,te)=>(B(),G(le,{key:te},[D("div",Ho,oe(O.label),1),(B(!0),G(le,null,Ce(O.messages,(W,E)=>(B(),G("div",{key:`${te}-${E}`,class:be(["message-row",W.sender_id===x(e)?"sent":"received"])},[D("div",qo,[D("div",Yo,[J(oe(W.text)+" ",1),D("span",Xo,[J(oe(x(A)(W.timestamp))+" ",1),W.sender_id===x(e)?(B(),Ie($,{key:0,size:"16",class:be(["status-icon",x(C)(x(a).indexOf(W))?"check-leido":"check-no-leido"])},{default:V(()=>m[3]||(m[3]=[J(" mdi-check-all ")])),_:2},1032,["class"])):fe("",!0)])])])],2))),128))],64))),128))],512),D("div",Zo,[U($,{class:"emoji-icon",onClick:De(x(y),["stop"])},{default:V(()=>m[4]||(m[4]=[J("mdi-emoticon-outline")])),_:1},8,["onClick"]),vt(D("input",{"onUpdate:modelValue":m[0]||(m[0]=O=>Xt(l)?l.value=O:null),placeholder:z.$t("chats.escribirMensaje"),class:"message-input",onKeydown:[m[1]||(m[1]=(...O)=>x(b)&&x(b)(...O)),m[2]||(m[2]=Et(De((...O)=>x(j)&&x(j)(...O),["prevent"]),["enter"]))]},null,40,Jo),[[kt,x(l)]]),U($,{class:"send-icon",onClick:x(j)},{default:V(()=>m[5]||(m[5]=[J("mdi-send")])),_:1},8,["onClick"])]),U(wt,{name:"fade"},{default:V(()=>[x(p)?(B(),G("div",Qo,[U(q,{onEmojiClick:x(f)},null,8,["onEmojiClick"])])):fe("",!0)]),_:1})]}),_:1},8,["style"])}}},ti=pt(ei,[["__scopeId","data-v-411cbc94"]]),oi={__name:"ChatView",setup(t){const e=K(!1);return Je(()=>{const n=()=>{e.value=window.innerWidth<=768};n(),window.addEventListener("resize",n),We(()=>window.removeEventListener("resize",n))}),(n,i)=>(B(),Ie(Zt(e.value?ti:Uo)))}};export{oi as default};
